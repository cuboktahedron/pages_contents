/**
 * Tetsimu
 * Copyright (c) 2015 cuboktahedron
 * This software is released under the MIT License.
 * https://github.com/cuboktahedron/tetsimu/blob/master/MIT-LICENSE.txt
 */
var C={Random:new MersenneTwister()};(function(){var a={};a.Version=0.97;a.ConfigVersion=0.97;a.Action={Config:{CancelConfig:"config-cancelConfig",StoreConfig:"config-storeKeyConfig",},Controller:{KeyDown:"controller-KeyDown",KeyUp:"controller-KeyUp",},Edit:{BackNext:"edit-backNext",BeginSetCell:"edit-beginSetCell",BuildDownField:"edit-buildDownField",BuildUpField:"edit-buildUpField",Cancel:"edit-cancel",ChangeModeToSimu:"edit-changeModeToSimu",CreateUrlParameters:"edit-createUrlParameters",Clear:"edit-clear",DeleteNext:"edit-deleteNext",EndSetCell:"edit-endSetCell",ForwardNext:"edit-forwardNext",Initialize:"edit-initialize",InsertNext:"edit-insertNext",SelectType:"edit-selectType",SetCell:"edit-setCell",SetHold:"edit-setHold",SetNext:"edit-setNext",},Mouse:{Down:"mouse-KeyDown",Up:"mouse-KeyUp",},Simu:{Back:"simu-back",BackToEditMode:"simu-backToEditMode",BackToHead:"simu-backToHead",ChangeModeToEdit:"simu-changeModeToEdit",ChangeModeToSimu:"simu-changeModeToSimu",ChangeModeToReplay:"simu-changeModeToReplay",Clear:"simu-clear",CreateUrlParameters:"simu-createUrlParameters",Forward:"simu-forward",HardDrop:"simu-hardDrop",Hold:"simu-hold",Initialize:"simu-initialize",Move:"simu-move",ToggleNextVisible:"simu-toggleNextVisible",TurnRight:"simu-turnRight",TurnLeft:"simu-turnLeft",Retry:"simu-retry"},Replay:{Back:"replay-back",BackToHead:"replay-backToHead",CancelConfig:"replay-cancelConfig",ChangeModeToSimu:"replay-changeModeToSimu",CreateUrlParameters:"replay-createUrlParameters",Forward:"replay-forward",Initialize:"replay-initialize",},};a.Event={Cancel:"cancel",Change:"change",ChangeMode:"changeMode",SetUrl:"setUrl",Key:"Key"};a.Mode={Simu:"0",Replay:"1",Edit:"2"};a.KeyNames=["shift","ctrl","caps","esc","space","left","up","right","down","0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","cmd","num_0","num_1","num_2","num_3","num_4","num_5","num_6","num_7","num_8","num_9","num_multiply","num_add","num_enter","num_subtract","num_decimal","num_divide",";","=",",","-",".","/","`","[","\\","]","'","`","-","?",">","<",'"',":","{","}","|","~","+","_","!","@","#","$","%","^","&","*","(",")"];a.ShiftedKeys=["?",">","<",'"',":","{","}","|","~","+","_","!","@","#","$","%","^","&","*","(",")"];a.MouseButton={Left:1,};a.SpinType={None:"0",TSpin:"1",TSpinMini:"2"};a.Trick={None:"0",Single:"1",Double:"2",Triple:"3",Tetris:"4",TSSM:"5",TSS:"6",TSD:"7",TST:"8",TSM:"9",TS:"10",OverTetris:"11",};a.StepType={None:"0",HardDrop:"1",SoftDrop:"2",Hold:"3",Ojama:"4"};C.Constants=a})();(function(){var a=function(){this._id=0;this._callbacks={}};a.prototype={_ID_PREFIX:"id_",register:function(c){var b=this._ID_PREFIX+(this._id++);this._callbacks[b]=c;return b},unregister:function(b){delete this._callbacks[b]},dispatch:function(b){var c;for(c in this._callbacks){this._callbacks[c](b)}}};C.Dispatcher=a})();(function(){var a=function(){C.Dispatcher.call(this)};a.prototype=$.extend({handleViewAction:function(b){this.dispatch({source:"VIEW_ACTION",action:b})}},C.Dispatcher.prototype);C.AppDispatcher=new a()})();(function(){var a={Up:1,Left:2,Down:4,Right:8,turnLeft:function(b){switch(b){case a.Up:return a.Left;case a.Left:return a.Down;case a.Down:return a.Right;case a.Right:return a.Up;default:throw new Error("invalid direction("+b+")")}},turnRight:function(b){switch(b){case a.Up:return a.Right;case a.Left:return a.Up;case a.Down:return a.Left;case a.Right:return a.Down;default:throw new Error("invalid direction("+b+")")}}};C.Direction=a})();(function(){var a=function(c,b,d){this.type(c);this.pivot(b||{x:0,y:0});this.direction(d||C.Direction.Up)};a._SuperRotations=(function(){var b={left:{},right:{}};b.left[C.Direction.Up]=[{x:1,y:0},{x:1,y:1},{x:0,y:-2},{x:1,y:-2}];b.left[C.Direction.Left]=[{x:-1,y:0},{x:-1,y:-1},{x:0,y:2},{x:-1,y:2}];b.left[C.Direction.Down]=[{x:-1,y:0},{x:-1,y:1},{x:0,y:-2},{x:-1,y:-2}];b.left[C.Direction.Right]=[{x:1,y:0},{x:1,y:-1},{x:0,y:2},{x:1,y:2}];b.right[C.Direction.Up]=[{x:-1,y:0},{x:-1,y:1},{x:0,y:-2},{x:-1,y:-2}];b.right[C.Direction.Left]=[{x:-1,y:0},{x:-1,y:-1},{x:0,y:2},{x:-1,y:2}];b.right[C.Direction.Down]=[{x:1,y:0},{x:1,y:1},{x:0,y:-2},{x:1,y:-2}];b.right[C.Direction.Right]=[{x:1,y:0},{x:1,y:-1},{x:0,y:2},{x:1,y:2}];return b})();a.prototype={SuperRotationsLeft:function(){return a._SuperRotations.left[this.direction()]},SuperRotationsRight:function(){return a._SuperRotations.right[this.direction()]},pivot:function(b){if(b===undefined){return this._pivot}else{this._pivot=b}},direction:function(b){if(b===undefined){return this._direction}else{this._direction=b}},type:function(b){if(b===undefined){return this._type}else{this._type=b}},turnLeft:function(){this.direction(C.Direction.turnLeft(this.direction()))},turnRight:function(){this.direction(C.Direction.turnRight(this.direction()))},blocks:function(){var c=this,b=this.Shape();return b.map(function(e,d){return{x:e.x+c.pivot().x,y:e.y+c.pivot().y}})},copy:function(){return $.extend(true,{},this)},hardDrop:function(d){var c=0;var b;while(!d.isGround(this)){b=this.pivot();b.y--;this.pivot(b);c++;if(c>100){break}}},move:function(c){var b=this.pivot();b.x+=c.x;b.y+=c.y;this.pivot(b)},canMove:function(e,c){var b=this.copy(),g,f,d;b.move(c);g=b.blocks();for(d in g){f=g[d];if(C.CellType.isBlock(e.type(f.x,f.y))){return false}}return true},turnLeftIfPossible:function(c,b){this._initSpecialInfo(b);this.turnLeft();if(this._isOverwrap(c)){this.turnRight();return false}return true},_isOverwrap:function(c){var e=this.blocks(),d,b;for(b in e){d=e[b];if(C.CellType.isBlock(c.type(d.x,d.y))){return true}}return false},turnLeftSuperlyIfPossible:function(g,c){this._initSpecialInfo(c);var e=this.SuperRotationsLeft(),d,b,f;if(this._turnLeftSuperlyIfPossible(g,e,c)){return true}return false},_turnLeftSuperlyIfPossible:function(g,f,d){var e,b,c=this.pivot();this.turnLeft();for(e=0,b=f.length;e<b;e++){this.pivot({x:c.x+f[e].x,y:c.y+f[e].y});if(!this._isOverwrap(g)){d._option=f.option||{};return true}this.pivot(c)}this.turnRight();return false},turnRightIfPossible:function(c,b){this._initSpecialInfo(b);this.turnRight();if(this._isOverwrap(c)){this.turnLeft();return false}return true},turnRightSuperlyIfPossible:function(g,c){this._initSpecialInfo(c);var e=this.SuperRotationsRight(),d,b,f;if(this._turnRightSuperlyIfPossible(g,e,c)){return true}return false},_turnRightSuperlyIfPossible:function(g,f,d){var e,b,c=this.pivot();this.turnRight();for(e=0,b=f.length;e<b;e++){this.pivot({x:c.x+f[e].x,y:c.y+f[e].y});if(!this._isOverwrap(g)){d._option=f.option||{};return true}this.pivot(c)}this.turnLeft();return false},_initSpecialInfo:function(b){$.extend(b,{spinType:C.Constants.SpinType.None})}};a.makeRotationPattern=function(d,m){var o,l,c=$.extend(true,[],d),h,n,b,g,k,f,e;switch(m){case C.Direction.Up:o=1;l=0;break;case C.Direction.Left:o=0;l=1;break;case C.Direction.Down:o=-1;l=0;break;case C.Direction.Right:o=0;l=-1;break}for(h=c.length-1;h>=0;h--){b=c[h];if(b.targets.indexOf(m)!=-1){for(g=0,k=b.conditions.length;g<k;g++){b.conditions[g]={x:b.conditions[g].x*o-b.conditions[g].y*l,y:b.conditions[g].x*l+b.conditions[g].y*o}}b.movement={x:b.movement.x*o-b.movement.y*l,y:b.movement.x*l+b.movement.y*o}}else{c.splice(h,1)}}return c};a.makeFlipHorizonPattern=function(d){var m=$.extend(true,{},d),g,b,f,c,k,e,h,l;f=m[C.Direction.Left];m[C.Direction.Left]=m[C.Direction.Right];m[C.Direction.Right]=f;for(c in m){g=m[c];for(k=0,e=g.length;k<e;k++){b=g[k];for(h=0,l=b.conditions.length;h<l;h++){b.conditions[h]={x:-b.conditions[h].x,y:b.conditions[h].y}}b.movement={x:-b.movement.x,y:b.movement.y}}}return m};C.Tetrimino=a})();(function(){var a={create:function(c,b,d){switch(c){case C.CellType.I:return new C.TetriminoI(b,d);case C.CellType.J:return new C.TetriminoJ(b,d);case C.CellType.L:return new C.TetriminoL(b,d);case C.CellType.O:return new C.TetriminoO(b,d);case C.CellType.S:return new C.TetriminoS(b,d);case C.CellType.T:return new C.TetriminoT(b,d);case C.CellType.Z:return new C.TetriminoZ(b,d);default:throw new Error("invalid tetrimino type("+c+")")}}};C.TetriminoFactory=a})();(function(){var a={None:"0",I:"1",J:"2",L:"3",O:"4",S:"5",T:"6",Z:"7",Ojama:"8",Wall:"9",isBlock:function(b){return b>=C.CellType.I&&b<=C.CellType.Wall}};C.CellType=a})();(function(){var a={build:function(c){var b={};b.initialMode=this._buildInitialMode(c);b.field=this._buildField(c);b.hold=this._buildHold(c);b.nexts=this._buildNexts(c);b.nextsVisibled=this._buildNextsVisibled(c);b.prevs=this._buildPrevs(c);b.steps=this._buildSteps(c);b.seed=this._buildSeed(c);return b},_buildInitialMode:function(b){return b.m==null?C.Constants.Mode.Simu:b.m},_buildField:function(b){return b.f||""},_buildHold:function(b){return b.h||""},_buildNexts:function(b){return b.ns||""},_buildNextsVisibled:function(b){return b.nv||"v"},_buildPrevs:function(b){return b.ps||""},_buildSteps:function(b){return b.ss||""},_buildSeed:function(b){return b.s==null?null:Number(b.s)}};C.ContextBuilder=a})();(function(){var a=function(){this.current({ren:0,clearLineNum:0,spinType:C.Constants.SpinType.None,perfectCleared:false,prevTrick:C.Constants.Trick.None})};a.prototype={ren:function(b){if(b===undefined){return this._ren}else{this._ren=b}},clearLineNum:function(b){if(b===undefined){return this._clearLineNum}else{this._clearLineNum=b}},spinType:function(b){if(b===undefined){return this._spinType}else{this._spinType=b}},perfectCleared:function(b){if(b===undefined){return this._perfectCleared}else{this._perfectCleared=b}},fixData:function(){var c={},d=this.spinType(),b=this.clearLineNum(),e=C.Constants.SpinType;c.ren=this.ren();c.perfectCleared=this.perfectCleared();switch(true){case b===0&&d===e.TSpin:c.trick=C.Constants.Trick.TS;break;case b===0&&d===e.TSpinMini:c.trick=C.Constants.Trick.TSM;break;case b===0:c.trick=C.Constants.Trick.None;break;case b===1&&d===e.None:c.trick=C.Constants.Trick.Single;break;case b===1&&d===e.TSpin:c.trick=C.Constants.Trick.TSS;break;case b===1&&d===e.TSpinMini:c.trick=C.Constants.Trick.TSSM;break;case b===2&&(d===e.None):c.trick=C.Constants.Trick.Double;break;case b===2&&(d===e.TSpinMini||d===e.TSpin):c.trick=C.Constants.Trick.TSD;break;case b===3&&(d===e.None):c.trick=C.Constants.Trick.Triple;break;case b===3&&(d===e.TSpinMini||d===e.TSpin):c.trick=C.Constants.Trick.TST;break;case b===4:c.trick=C.Constants.Trick.Tetris;break;case b>4:c.trick=C.Constants.Trick.OverTetris;break}if(this.data()){c.b2b=this._isB2b(c.trick)}else{c.b2b=false}if(b>0){this._prevTrick=c.trick}this._data=c},_isB2b:function(b){return this._isB2bTrick(this._prevTrick)&&this._isB2bTrick(b)},_isB2bTrick:function(b){return b===C.Constants.Trick.Tetris||b===C.Constants.Trick.TSSM||b===C.Constants.Trick.TSS||b===C.Constants.Trick.TSD||b===C.Constants.Trick.TST},current:function(b){if(b===undefined){return{ren:this._ren,clearLineNum:this._clearLineNum,spinType:this._spinType,perfectCleared:this._perfectCleared,prevTrick:this._prevTrick}}else{this._ren=b.ren;this._clearLineNum=b.clearLineNum;this._spinType=b.spinType;this._perfectCleared=b.perfectCleared;this._prevTrick=b.prevTrick;this.fixData()}},data:function(){return $.extend({},this._data)}};C.Description=a})();(function(){var a={deserialize:function(d){d=d||"";var k=[],g=C.Field.DEFAULT_HEIGHT*7-d.length,h,f,e,c,b=new C.RadixConverter(64);for(h=0;h<g;h++){d="0"+d}for(h=C.Field.DEFAULT_HEIGHT-1;h>=0;h--){k[h]=[];e=b.convertToDecimal(d.substring(0,7));d=d.substring(7);for(f=C.Field.DEFAULT_WIDTH-1;f>=0;f--){c=e%(1<<4);k[h][f]=""+c;e=(e-c)/(1<<4)}}return k}};C.FieldDeserializer=a})();(function(){var a={serialize:function(h){var d,i,f=true,e,g,c="",b=new C.RadixConverter(64);for(i=C.Field.DEFAULT_HEIGHT-1;i>=0;i--){e=0;g="";for(d=0;d<C.Field.DEFAULT_WIDTH;d++){e=e*(1<<4);e+=(Number(h[i][d]))}if(f&&e!==0){f=false;g=b.convertFromDecimal(e)}else{if(!f){g=b.convertFromDecimal(e)}}while(g.length%7>0){g="0"+g}c+=g}return c}};C.FieldSerializer=a})();(function(){var a=function(){var b=this;this._width=a.DEFAULT_WIDTH;this._height=a.DEFAULT_HEIGHT;this._innerHeight=a.DEFAULT_INNER_HEIGHT;this._types=[];this.deserialize();this._EmptyLine=(function(){var d=[],c;for(c=0;c<=b._maxWidth();c++){d.push(C.CellType.None)}return d})()};a.DEFAULT_HEIGHT=25;a.DEFAULT_INNER_HEIGHT=21;a.DEFAULT_WIDTH=10;a.prototype={innerTypes:function(){var b=this.types().concat();b.splice(this._innerHeight,this._height-this._innerHeight);return b},types:function(){return this._types},deserialize:function(b){this._types=C.FieldDeserializer.deserialize(b)},serialize:function(){return C.FieldSerializer.serialize(this.types())},type:function(b,d,c){if(c===undefined){if(this._isOutOfField(b,d)){return C.CellType.Wall}else{return this._types[d][b]}}else{if(!this._isOutOfField(b,d)){this._types[d][b]=c}}},_isOutOfField:function(b,c){return b<0||b>this._maxWidth()||c<0||c>this._maxHeight()},_maxWidth:function(){return this._width-1},_maxHeight:function(){return this._height-1},isGround:function(b){var c,e,d=b.blocks();for(c in d){e=d[c];if(C.CellType.isBlock(this.type(e.x,e.y-1))){return true}}return false},settle:function(b){var e=b.blocks(),d,c;for(c in e){d=e[c];this.type(d.x,d.y,b.type())}},clearLine:function(){var e=0,b,d,c;for(d=0;d<=this._maxHeight();d++){c=true;for(b=0;b<=this._maxWidth();b++){if(!C.CellType.isBlock(this.type(b,d))){c=false;break}}if(c){e++;this._types.splice(d,1);this._types.push(this._EmptyLine.concat());d--}}return e},startPivot:function(){return{x:this._width/2-1,y:this._innerHeight-2,}},isPerfectCleared:function(){var b,c;for(c=0;c<=this._maxHeight();c++){for(b=0;b<=this._maxWidth();b++){if(C.CellType.isBlock(this.type(b,c))){return false}}}return true},};C.Field=a})();(function(){var a=function(b){b=$.extend({},{maxHistoryNum:a.DEFAULT_MAX_HISTORY_NUM},b);this._histories=[];this._p=-1;this._maxHistoryNum=b.maxHistoryNum};a.DEFAULT_MAX_HISTORY_NUM=1000;a.prototype={push:function(j,n,o,b,p){var l=j==null?C.CellType.None:j.type(),g=n.serialize(),m=o.no(),e=b.serialize(),k=p.current(),i=new C.History(l,g,m,e,k);this._histories.length=(this._p+1);this._push(l,g,m,e,k)},_push:function(f,e,b,d,c){this._histories.push(new C.History(f,e,b,d,c));if(this._p+1===this._maxHistoryNum){this._histories.shift()}else{this._p++}},length:function(){return this._histories.length},canBack:function(){return this._p>0},back:function(){if(this.canBack()){this._p--}},canForward:function(){return this._p<this.length()-1},forward:function(){if(this.canForward()){this._p++}},current:function(){return this._histories[this._p]}};C.Histories=a})();(function(){var b=(function(){var c=0;return function(){return ++c}});var a=function(g,f,c,e,d){this._id=b();this._current=g;this._field=f;this._nextNo=c;this._hold=e;this._description=d};a.prototype={id:function(){return this._id},current:function(){return this._current},field:function(){return this._field},nextNo:function(){return this._nextNo},hold:function(){return this._hold},description:function(){return $.extend({},this._description)},};C.History=a})();(function(){var a=function(){this._type=C.CellType.None;this._canExchange=true};a.prototype={type:function(b){if(b===undefined){return this._type}else{this._type=b}},exchange:function(b){if(!this._canExchange){throw new Error("Cannot exchange")}var c=this.type();this.type(b);this._canExchange=false;return c},canExchange:function(){return this._canExchange},release:function(){this._canExchange=true},deserialize:function(d){var b=new C.RadixConverter(64),c;d=d||"0";c=b.convertToDecimal(d);this.type(""+((c&14)>>1));this._canExchange=((c&1)===0)},serialize:function(){var b=new C.RadixConverter(64),c;c=Number(this.type())<<1;c+=(this.canExchange()?0:1);return b.convertFromDecimal(c)}};C.Hold=a})();(function(){var a=function(){this._configure={interval1:0.1,interval2:0.02};this._prev=false;this._current=false;this._intervalDown=false;this._prevDate=null;this._currentInterval=-1};a.prototype={keyDown:function(){var b;this._prev=this._current;this._current=true;if(this._prevDate!=null){b=new Date();if(b-this._prevDate>=this._currentInterval*1000){this._prevDate=b;this._intervalDown=true;this._currentInterval=this._configure.interval2}else{this._intervalDown=false}}else{this._intervalDown=true;this._prevDate=new Date();this._currentInterval=this._configure.interval1}},keyUp:function(){this._prev=this._current;this._current=false;this._intervalDown=false;this._prevDate=null},state:function(){return{active:this._current,down:!this._prev&&this._current,up:this._prev&&!this._current,intervalDown:this._intervalDown}},configure:function(b){this._configure=$.extend({interval1:0.3,interval2:0.1},b)}};C.KeyButton=a})();(function(){var a=function(){this.reset()};a.Types=[C.CellType.I,C.CellType.J,C.CellType.L,C.CellType.O,C.CellType.S,C.CellType.T,C.CellType.Z];a.prototype={next:function(){var b,c;if(this._currentSet.length==0){this._currentSet=a.Types.concat()}b=C.Random.nextInt(this._currentSet.length);c=this._currentSet[b];this._currentSet.splice(b,1);return c},removeTypes:function(b){this._currentSet=this._currentSet.filter(function(c){return b.indexOf(c)===-1})},reset:function(){this._currentSet=a.Types.concat()}};C.NextGenerator=a})();(function(){var a={deserialize:function(g){var e,c,f,b=new C.RadixConverter(64),d=[];for(e=0,c=g.length;e<c;e++){f=b.convertToDecimal(g[e]);d.push(""+parseInt(f>>3));d.push(""+(f&7))}if(d.length>0&&d[d.length-1]===C.CellType.None){d.pop()}return d}};C.NextsDeserializer=a})();(function(){var a={serialize:function(f){var e,d,g,c="",b=new C.RadixConverter(64);if(f.length%2!=0){f.push(C.CellType.None)}for(e=0,d=f.length;e<d;e+=2){g=Number(f[e])<<3;g+=Number(f[e+1]);c+=b.convertFromDecimal(g)}return c},};C.NextsSerializer=a})();(function(){var a={deserialize:function(e){var b=new C.RadixConverter(64),d=b.convertToDecimal(e),c=[];c[0]=(d&1)>0;c[1]=(d&2)>0;c[2]=(d&4)>0;c[3]=(d&8)>0;c[4]=(d&16)>0;return c}};C.NextsVisibledDeserializer=a})();(function(){var a={serialize:function(c){var b=new C.RadixConverter(64),d=0;d+=(c[0]?1:0);d+=(c[1]?2:0);d+=(c[2]?4:0);d+=(c[3]?8:0);d+=(c[4]?16:0);return b.convertFromDecimal(d)}};C.NextsVisibledSerializer=a})();(function(){var a=function(){this._visibled=[true,true,true,true,true]};a.prototype={status:function(){return this._visibled.concat()},toggleVisible:function(b){if(b<0||b>=5){throw new Error("out of bounds index("+b+")")}this._visibled[b]=!this._visibled[b]},serialize:function(){return C.NextsVisibledSerializer.serialize(this._visibled)},deserialize:function(b){this._visibled=C.NextsVisibledDeserializer.deserialize(b)}};C.NextsVisibled=a})();(function(){var a={serialize:function(c){var b=new C.RadixConverter(64),d=0;d+=(c[0]?1:0);d+=(c[1]?2:0);d+=(c[2]?4:0);d+=(c[3]?8:0);d+=(c[4]?16:0);return b.convertFromDecimal(d)}};C.NextsVisibledSerializer=a})();(function(){var a={deserialize:function(e){var b=new C.RadixConverter(64),d=b.convertToDecimal(e),c=[];c[0]=(d&1)>0;c[1]=(d&2)>0;c[2]=(d&4)>0;c[3]=(d&8)>0;c[4]=(d&16)>0;return c}};C.NextsVisibledDeserializer=a})();(function(){var a=function(){this._p=-1;this._types=[];this._typesFixed=[]};a.prototype={push:function(b){this._types.push(b)},no:function(b){if(b===undefined){return this._p}else{this._p=b}},next:function(){this._p++;return this._types[this._p]},types:function(b){if(b===undefined){return this._types.concat()}else{this._types=b.concat();this._p=-1}},setAndComplementTypes:function(h,d,j){var l=[],c=d.reverse().concat(h),b,k,e,g,f;this._typesFixed=h.map(function(i){return i!==C.CellType.None});while((f=this._nextTypesSet(c)).length>0){j.reset();b=f.filter(function(i){return i!==C.CellType.None});j.removeTypes(b);for(e=0,g=f.length;e<g;e++){k=f[e];if(k===C.CellType.None){k=j.next()}l.push(k)}c=c.slice(f.length)}this.types(l.slice(d.length))},_nextTypesSet:function(e){var d,b=e.length,f,c={};if(b>7){b=7}for(d=0;d<b;d++){f=e[d];if((f in c)&&f!==C.CellType.None){return e.slice(0,d)}c[f]=true}return e.slice(0,7)},nextTypes:function(){var b=this._types.concat();b.splice(0,this._p+1);return b},nextTypesFixed:function(){var b=this._typesFixed.concat();b.splice(0,this._p+1);return b},length:function(){return this._types.length},nextsLength:function(){return this._types.length-(this._p+1)},typeAt:function(e,d){var f,c,g,b=-1;if(d===undefined){return this._types[e]||C.CellType.None}else{this._types[e]=d;for(f=this._types.length-1;f>=0;f--){g=this._types[f];if(g===undefined){this._types[f]=C.CellType.None}else{if(g!==C.CellType.None&&b===-1){b=f}}}if(this._types.length!==b+1){this._types.length=b+1;this._p=-1}}},insertAt:function(c,b){this._types.splice(c,0,C.CellType.None);this.typeAt(c,b)},deleteAt:function(b){this._types.splice(b,1)},serialize:function(){return C.NextsSerializer.serialize(this._types)},deserialize:function(c){var b=C.NextsDeserializer.deserialize(c);this._p=-1;this.types(b)}};C.Nexts=a})();(function(){var a=function(b){this._base=b};a._BaseChars="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-_";a._BaseChars2NumMap=(function(){var f,d,b,e={};for(d=0,b=a._BaseChars.length;d<b;d++){f=a._BaseChars.charAt(d);e[f]=d}return e})();a.prototype={convertFromDecimal:function(b){var e="",d,c;do{d=Math.floor(b/this._base);c=b%this._base;e=a._BaseChars.charAt(c)+e;b=d}while(b>0);return e},convertToDecimal:function(f){var e=0,d,b;for(d=0,b=f.length;d<b;d++){if(d!==0){e*=this._base}var g=f.charAt(d);e+=a._BaseChars2NumMap[g]}return e}};C.RadixConverter=a})();(function(){var a=function(){this._p=-1;this._steps=[]};a.GroupMaxBit=52;a.prototype={pushTetrimino:function(c,d,b){this._steps.push(this._makeTetriminoStep(c,d,b))},_makeTetriminoStep:function(d,f,b){var e,c=false;if(f===C.Constants.SpinType.TSpin||f===C.Constants.SpinType.TSpinMini){c=true}if(b&&!c){return new C.Step({stepType:C.Constants.StepType.HardDrop,pos:d.pivot().x,direction:d.direction(),})}else{return new C.Step({stepType:C.Constants.StepType.SoftDrop,pivot:d.pivot(),direction:d.direction(),isTSpin:c})}},pushHold:function(){this._steps.push(this._makeHoldStep())},_makeHoldStep:function(b){return new C.Step({stepType:C.Constants.StepType.Hold,})},steps:function(){return this._steps},length:function(){return this._steps.length},serialize:function(){var e,f,g=this.steps(),c,d,b=0,h=0,k="",j=new C.RadixConverter(64);f=this._steps.length;if(f===0){return""}for(e=0;e<f;e++){c=this._steps[e];if(c.stepType===C.Constants.StepType.Hold){d=this._serialize4Hold()}else{if(c.stepType===C.Constants.StepType.Ojama){throw new Error("not implemented stepType("+c.stepType+")")}else{if(c.stepType===C.Constants.StepType.HardDrop){d=this._serialize4HardDrop(c)}else{if(c.stepType===C.Constants.StepType.SoftDrop){d=this._serialize4SoftDrop(c)}else{throw new Error("invalid stepType("+c.stepType+")")}}}}if(b+d.bitNum>a.GroupMaxBit){h=this._shiftBit(h,(a.GroupMaxBit-b));k+=j.convertFromDecimal(h);h=d.value;b=d.bitNum}else{h=this._shiftBit(h,d.bitNum);h+=d.value;b+=d.bitNum}}h=this._shiftBit(h,(a.GroupMaxBit-b));k+=j.convertFromDecimal(h);return k},_shiftBit:function(c,b){if(b>=0){while(b>0){c*=2;b--}}else{while(b<0){c/=2;b++}}return c},_serialize4Hold:function(){return{bitNum:4,value:Number(C.Constants.StepType.Hold)}},_serialize4HardDrop:function(b){var e,d,c;switch(b.direction){case C.Direction.Up:c=0;break;case C.Direction.Left:c=1;break;case C.Direction.Down:c=2;break;case C.Direction.Right:c=3;break}e=10;d=Number(b.stepType);d<<=4;d+=(b.pos+1);d<<=2;d+=c;return{bitNum:e,value:d}},_serialize4SoftDrop:function(b){var e,d,c;switch(b.direction){case C.Direction.Up:c=0;break;case C.Direction.Left:c=1;break;case C.Direction.Down:c=2;break;case C.Direction.Right:c=3;break}d=Number(b.stepType);e=15;d<<=8;d+=(b.pivot.y*C.Field.DEFAULT_WIDTH+b.pivot.x+1);d<<=2;d+=c;d<<=1;d+=b.isTSpin?1:0;return{bitNum:e,value:d}},deserialize:function(c){var e,g,j,k=new C.RadixConverter(64),d,f,b,h=[];while(c.length>0){j=k.convertToDecimal(c.substring(0,9));c=c.substring(9);d=52;while(d>0){f=String(this._shiftBit(j,-(d-4))&15);if(f===C.Constants.StepType.Hold){b=this._deserialize4Hold();d-=4}else{if(f===C.Constants.StepType.Ojama){throw new Error("not implemented stepType("+f+")")}else{if(f===C.Constants.StepType.HardDrop){b=this._deserialize4HardDrop(j,d);d-=10}else{if(f===C.Constants.StepType.SoftDrop){b=this._deserialize4SoftDrop(j,d);d-=15}else{if(f===C.Constants.StepType.None){break}else{throw new Error("invalid stepType("+f+")")}}}}}h.push(b)}}this._steps=h},_deserialize4Hold:function(){return{stepType:C.Constants.StepType.Hold,}},_deserialize4HardDrop:function(e,f){var c=this._shiftBit(e,-(f-10))&1023,b,h,d,g=[C.Direction.Up,C.Direction.Left,C.Direction.Down,C.Direction.Right];b=C.Constants.StepType.HardDrop;h=((c>>2)&15)-1;d=c&3;return{stepType:b,pos:h,direction:g[d]}},_deserialize4SoftDrop:function(f,g){var d=this._shiftBit(f,-(g-15))&2047,c,i,e,h=[C.Direction.Up,C.Direction.Left,C.Direction.Down,C.Direction.Right],b;c=C.Constants.StepType.SoftDrop;i=((d>>3)&255)-1;e=(d>>1)&3;b=(d&1)==1;return{stepType:c,pivot:{x:i%C.Field.DEFAULT_WIDTH,y:Math.floor(i/C.Field.DEFAULT_WIDTH)},direction:h[e],isTSpin:b}},forward:function(){var b=this.length();if(this._p===b){return null}else{if(this._p===b-1){++this._p;return null}else{return this._steps[++this._p]}}},back:function(){if(this._p<0){return null}else{if(this._p===0){--this._p;return null}else{return this._steps[--this._p]}}},forgetAfter:function(){this._steps.length=(this._p+1)}};C.Steps=a})();(function(){var a=function(b){var c;for(c in b){this[c]=b[c]}};C.Step=a})();(function(){var a=function(b,c){C.Tetrimino.call(this,C.CellType.I,b,c)};a._Shape={};a._Shape[C.Direction.Up]=[{x:0,y:0},{x:-1,y:0},{x:1,y:0},{x:2,y:0}];a._Shape[C.Direction.Left]=[{x:0,y:-1},{x:0,y:-2},{x:0,y:0},{x:0,y:1}];a._Shape[C.Direction.Down]=[{x:1,y:-1},{x:2,y:-1},{x:0,y:-1},{x:-1,y:-1}];a._Shape[C.Direction.Right]=[{x:1,y:0},{x:1,y:1},{x:1,y:-1},{x:1,y:-2}];a._SuperRotations=(function(){var b={left:{},right:{}};b.left[C.Direction.Up]=[{x:-1,y:0},{x:2,y:0},{x:-1,y:2},{x:2,y:-1}];b.left[C.Direction.Left]=[{x:1,y:0},{x:-2,y:0},{x:-2,y:-1},{x:1,y:2}];b.left[C.Direction.Down]=[{x:1,y:0},{x:-2,y:0},{x:1,y:-2},{x:-2,y:1}];b.left[C.Direction.Right]=[{x:2,y:0},{x:-1,y:0},{x:2,y:1},{x:-1,y:-2}];b.right[C.Direction.Up]=[{x:-2,y:0},{x:1,y:0},{x:-2,y:-1},{x:1,y:2}];b.right[C.Direction.Left]=[{x:-2,y:0},{x:1,y:0},{x:1,y:-2},{x:-2,y:1}];b.right[C.Direction.Down]=[{x:2,y:0},{x:-1,y:0},{x:2,y:1},{x:-1,y:-2}];b.right[C.Direction.Right]=[{x:-1,y:0},{x:2,y:0},{x:-1,y:2},{x:2,y:-1}];return b})();a.prototype=$.extend({},C.Tetrimino.prototype,{Shape:function(){return a._Shape[this.direction()]},SuperRotationsLeft:function(){return a._SuperRotations.left[this.direction()]},SuperRotationsRight:function(){return a._SuperRotations.right[this.direction()]}});C.TetriminoI=a})();(function(){var a=function(b,c){C.Tetrimino.call(this,C.CellType.J,b,c)};a._Shape={};a._Shape[C.Direction.Up]=[{x:0,y:0},{x:-1,y:0},{x:1,y:0},{x:-1,y:1}];a._Shape[C.Direction.Left]=[{x:0,y:0},{x:0,y:-1},{x:0,y:1},{x:-1,y:-1}];a._Shape[C.Direction.Down]=[{x:0,y:0},{x:1,y:0},{x:-1,y:0},{x:1,y:-1}];a._Shape[C.Direction.Right]=[{x:0,y:0},{x:0,y:1},{x:0,y:-1},{x:1,y:1}];a.prototype=$.extend({},C.Tetrimino.prototype,{Shape:function(){return a._Shape[this.direction()]}});C.TetriminoJ=a})();(function(){var a=function(b,c){C.Tetrimino.call(this,C.CellType.L,b,c)};a._Shape={};a._Shape[C.Direction.Up]=[{x:0,y:0},{x:-1,y:0},{x:1,y:0},{x:1,y:1}];a._Shape[C.Direction.Left]=[{x:0,y:0},{x:0,y:-1},{x:0,y:1},{x:-1,y:1}];a._Shape[C.Direction.Down]=[{x:0,y:0},{x:1,y:0},{x:-1,y:0},{x:-1,y:-1}];a._Shape[C.Direction.Right]=[{x:0,y:0},{x:0,y:1},{x:0,y:-1},{x:1,y:-1}];a.prototype=$.extend({},C.Tetrimino.prototype,{Shape:function(){return a._Shape[this.direction()]}});C.TetriminoL=a})();(function(){var a=function(b,c){C.Tetrimino.call(this,C.CellType.O,b,c)};a._Shape={};a._Shape[C.Direction.Up]=[{x:0,y:0},{x:0,y:1},{x:1,y:1},{x:1,y:0}];a._Shape[C.Direction.Left]=a._Shape[C.Direction.Up];a._Shape[C.Direction.Down]=a._Shape[C.Direction.Up];a._Shape[C.Direction.Right]=a._Shape[C.Direction.Up];a.prototype=$.extend({},C.Tetrimino.prototype,{Shape:function(){return a._Shape[this.direction()]}});C.TetriminoO=a})();(function(){var a=function(b,c){C.Tetrimino.call(this,C.CellType.S,b,c)};a._Shape={};a._Shape[C.Direction.Up]=[{x:0,y:0},{x:-1,y:0},{x:0,y:1},{x:1,y:1}];a._Shape[C.Direction.Left]=[{x:0,y:0},{x:0,y:-1},{x:-1,y:0},{x:-1,y:1}];a._Shape[C.Direction.Down]=[{x:0,y:0},{x:1,y:0},{x:0,y:-1},{x:-1,y:-1}];a._Shape[C.Direction.Right]=[{x:0,y:0},{x:0,y:1},{x:1,y:0},{x:1,y:-1}];a.prototype=$.extend({},C.Tetrimino.prototype,{Shape:function(){return a._Shape[this.direction()]}});C.TetriminoS=a})();(function(){var a=function(b,c){C.Tetrimino.call(this,C.CellType.T,b,c)};a._Shape={};a._Shape[C.Direction.Up]=[{x:0,y:0},{x:-1,y:0},{x:1,y:0},{x:0,y:1}];a._Shape[C.Direction.Left]=[{x:0,y:0},{x:-1,y:0},{x:0,y:1},{x:0,y:-1}];a._Shape[C.Direction.Down]=[{x:0,y:0},{x:-1,y:0},{x:1,y:0},{x:0,y:-1}];a._Shape[C.Direction.Right]=[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:0,y:-1}];a.prototype=$.extend({},C.Tetrimino.prototype,{Shape:function(){return a._Shape[this.direction()]},turnLeftIfPossible:function(c,b){if(!C.Tetrimino.prototype.turnLeftIfPossible.apply(this,arguments)){return false}if(this._metTSpin(c)){b.spinType=C.Constants.SpinType.TSpin}return true},turnLeftSuperlyIfPossible:function(c,b){if(!C.Tetrimino.prototype.turnLeftSuperlyIfPossible.apply(this,arguments)){return false}if(this._metTSpin(c)){if(this.canTSpin(c)){b.spinType=C.Constants.SpinType.TSpin}else{b.spinType=C.Constants.SpinType.TSpinMini}}return true},turnRightIfPossible:function(c,b){if(!C.Tetrimino.prototype.turnRightIfPossible.apply(this,arguments)){return false}if(this._metTSpin(c)){b.spinType=C.Constants.SpinType.TSpin}return true},turnRightSuperlyIfPossible:function(c,b){if(!C.Tetrimino.prototype.turnRightSuperlyIfPossible.apply(this,arguments)){return false}if(this._metTSpin(c)){if(this.canTSpin(c)){b.spinType=C.Constants.SpinType.TSpin}else{b.spinType=C.Constants.SpinType.TSpinMini}}return true},_metTSpin:function(d){var b=this.pivot(),c=0;if(C.CellType.isBlock(d.type(b.x-1,b.y-1))){c++}if(C.CellType.isBlock(d.type(b.x+1,b.y-1))){c++}if(C.CellType.isBlock(d.type(b.x-1,b.y+1))){c++}if(C.CellType.isBlock(d.type(b.x+1,b.y+1))){c++}return c>=3},canTSpin:function(c){var b;this.turnRight();b=!this._isOverwrap(c);this.turnLeft();return b}});C.TetriminoT=a})();(function(){var a=function(b,c){C.Tetrimino.call(this,C.CellType.Z,b,c)};a._Shape={};a._Shape[C.Direction.Up]=[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:-1,y:1}];a._Shape[C.Direction.Left]=[{x:0,y:0},{x:0,y:1},{x:-1,y:0},{x:-1,y:-1}];a._Shape[C.Direction.Down]=[{x:0,y:0},{x:-1,y:0},{x:0,y:-1},{x:1,y:-1}];a._Shape[C.Direction.Right]=[{x:0,y:0},{x:0,y:-1},{x:1,y:0},{x:1,y:1}];a.prototype=$.extend({},C.Tetrimino.prototype,{Shape:function(){return a._Shape[this.direction()]}});C.TetriminoZ=a})();(function(){var a={parse:function(d){var g={},h,f,c,e,b;h=d.split("?");if(h.length<2){return g}f=h[1].split("&");for(e=0,b=f.length;e<b;e++){c=f[e].split("=");g[c[0]]=c[1]}return g}};C.UrlParameter=a})();(function(){var a=$.extend({addListener:function(b,c){this.on(b,c)},removeListener:function(b,c){this.removeListener(b,c)},},EventEmitter.prototype);C.StoreBase=a})();(function(){var a=$.extend({_config:null,_modeValues:["simu","replay","edit",],storeConfig:function(b){this._config=b.config;this.emit(C.Constants.Event.Change)},config:function(){return this._config},keyConfig:function(b){var c=this._modeValues[b];if(this._config&&(c in this._config.key)){return this._reverseKeyValue(this._config.key[c])}else{return null}},_reverseKeyValue:function(d){var c={},b;for(b in d){c[d[b]]=b}return c},defaultConfig:function(b){return{version:C.Constants.ConfigVersion,key:{edit:{cancel:"esc",changeModeToSimu:"num_1",clear:"",configure:"?",createUrlParameters:"u",fieldUp:"shift + up",fieldDown:"shift + down",nextUp:"ctrl + up",nextDown:"ctrl + down",selectTypeI:"1",selectTypeJ:"2",selectTypeL:"3",selectTypeO:"4",selectTypeS:"5",selectTypeT:"6",selectTypeZ:"7",selectTypeOjama:"8",selectTypeNone:"9",setHold:"h",},simu:{backToEditMode:"esc",hardDrop:"up",leftMove:"left",softDrop:"down",rightMove:"right",turnLeft:"z",turnRight:"x",hold:"c",retry:"r",superRetry:"shift + r",back:"b",forward:"shift + b",clear:"",createUrlParameters:"u",changeModeToReplay:"num_1",changeModeToEdit:"num_2",configure:"?"},replay:{cancel:"esc",forward:"right",back:"left",backToHead:"r",createUrlParameters:"u",changeModeToSimu:"num_1",configure:"?"},}}},cancel:function(b){this.emit(C.Constants.Event.Cancel)},addChangeListener:function(b){this.addListener(C.Constants.Event.Change,b)},removeChangeListener:function(b){this.removeListener(C.Constants.Event.Change,b)},addCancelListener:function(b){this.addListener(C.Constants.Event.Cancel,b)},removeCancelListener:function(b){this.removeListener(C.Constants.Event.Cancel,b)}},C.StoreBase);C.AppDispatcher.register(function(c){var b=c.action;switch(b.actionType){case C.Constants.Action.Config.StoreConfig:a.storeConfig(b);break;case C.Constants.Action.Config.CancelConfig:a.cancel(b);break}return true});C.ConfigStore=a})();(function(){var a=$.extend({_ctrl:false,_cmd:false,_shift:false,_keyButtons:(function(){var d={},c,b;for(c=0,b=C.Constants.KeyNames.length;c<b;c++){d[C.Constants.KeyNames[c]]=new C.KeyButton()}return d})(),addKeyListener:function(b){this.addListener(C.Constants.Event.Key,b)},removeKeyListener:function(b){this.removeListener(C.Constants.Event.Key,b)},keyUp:function(d){var b=this._keyButtons[d.keyName],c;this._updateSpecialKeys(d,false);b.keyUp();c=b.state();c.keyName=d.keyName;this.emit(C.Constants.Event.Key,c)},keyDown:function(d){var b=this._keyButtons[d.keyName],c;this._updateSpecialKeys(d,true);b.keyDown();c=b.state();c.keyName=this._makeComboKeyName(d.keyName);this.emit(C.Constants.Event.Key,c)},_updateSpecialKeys:function(c,b){switch(c.keyName){case"shift":this._shift=b;break;case"ctrl":this._ctrl=b;break;case"cmd":this._cmd=b;break}},_makeComboKeyName:function(b){var c=[];if(b!="ctrl"&&this._ctrl){c.push("ctrl")}if(b!="shift"&&this._shift&&$.inArray(b,C.Constants.ShiftedKeys)===-1){c.push("shift")}if(b!="cmd"&&this._cmd){c.push("cmd")}c.push(b);return c.join(" + ")}},C.StoreBase);C.AppDispatcher.register(function(c){var b=c.action;switch(b.actionType){case C.Constants.Action.Controller.KeyUp:a.keyUp(b);break;case C.Constants.Action.Controller.KeyDown:a.keyDown(b);break;default:break}return true});C.ControllerStore=a})();(function(){var a=$.extend({_initialized:false,_context:null,_field:new C.Field(),_hold:new C.Hold(),_nextIndex:0,_nexts:new C.Nexts(),_prevs:new C.Nexts(),_nextGenerator:new C.NextGenerator(),_nextsVisibled:new C.NextsVisibled(),_selectedType:C.CellType.I,_urlParameters:"",initialize:function(c,b){if(this._initialized&&!c.context.force){this._context.before=c.context.before;return}this._initialized=true;this._context=c.context;this._nextsVisibled.deserialize(this._context.nextsVisibled);this._init(c.context);this.emit(C.Constants.Event.Change)},_init:function(b){this._field=new C.Field(),this._nextIndex=0,this._hold=new C.Hold(),this._nexts=new C.Nexts(),this._prevs=new C.Nexts(),this._nextGenerator=new C.NextGenerator(),this._field.deserialize(b.field);this._hold.deserialize(b.hold);this._nexts.deserialize(b.nexts);this._prevs.deserialize(b.prevs)},context:function(){return this._context},fieldTypes:function(){return this._field.innerTypes()},holdType:function(){return this._hold.type()},nexts:function(){return{prevs:this._prevs.types().slice(0,6),nexts:this._nexts.types(),index:0}},NextIndex:function(){return this._nextIndex},canHold:function(){return this._hold.canExchange()},selectedType:function(){return this._selectedType},urlParameters:function(){return this._urlParameters},createUrlParameters:function(i){var e=[],g=this._field.serialize(),d=this._hold.serialize(),c=this._nexts.serialize(),b=this._nextsVisibled.serialize(),j=this._prevs.serialize();if(!!g){e.push("f="+g)}if(!!c){e.push("ns="+c)}if(!!b&&b!="v"){e.push("nv="+b)}if(!!j){e.push("ps="+j)}if(!!d){e.push("h="+d)}e.push("v="+C.Constants.Version);this._urlParameters=e.join("&");this.emit(C.Constants.Event.SetUrl)},cancel:function(b){var c=C.Constants.Mode.Simu;this.emit(C.Constants.Event.ChangeMode,c,{before:C.Constants.Mode.Edit})},changeModeToSimu:function(b){var d=C.Constants.Mode.Simu;var c={before:C.Constants.Mode.Edit,field:this._field.serialize(),force:true,hold:this._hold.serialize(),nexts:C.NextsSerializer.serialize(this._nexts.types()),nextsVisibled:this._nextsVisibled.serialize(),prevs:C.NextsSerializer.serialize(this._prevs.types()),};this.emit(C.Constants.Event.ChangeMode,d,c)},clear:function(b){var d=C.Constants.Mode.Edit,c={force:true,field:"",hold:"",nexts:"",nextsVisibled:this._nextsVisibled.serialize(),prevs:""};this.emit(C.Constants.Event.ChangeMode,d,c)},beginSetCell:function(b){this._setCell(b.x,b.y,this._selectedType);this.emit(C.Constants.Event.Change)},setCell:function(b){this._setCell(b.x,b.y,this._selectedType);this.emit(C.Constants.Event.Change)},_setCell:function(b,d,c){this._field.type(b,d,c)},endSetCell:function(b){this.emit(C.Constants.Event.Change)},setHold:function(c){var b=this._selectedType;if(b===C.CellType.Ojama){b=C.CellType.None}if(b===C.CellType.None){this._hold.type(C.CellType.None);this._hold.release()}else{if(this._hold.type()===C.CellType.None){this._hold.type(b)}else{if(this._hold.type()!==b){this._hold.type(b)}else{if(this._hold.canExchange()){this._hold.exchange(b)}else{this._hold.type(C.CellType.None);this._hold.release()}}}}this.emit(C.Constants.Event.Change)},backNext:function(b){if(this._nextIndex<-5){return}this._nextIndex--;this.emit(C.Constants.Event.Change)},forwardNext:function(b){this._nextIndex++;this.emit(C.Constants.Event.Change)},deleteNext:function(b){this._nexts.deleteAt(b.index);this.emit(C.Constants.Event.Change)},insertNext:function(b){this._nexts.insertAt(b.index,C.CellType.None);this.emit(C.Constants.Event.Change)},setNext:function(c){var b=this._selectedType;if(b===C.CellType.Ojama){b=C.CellType.None}if(c.index<0){this._prevs.typeAt(-(c.index+1),b)}else{this._nexts.typeAt(c.index,b)}this.emit(C.Constants.Event.Change)},buildDownField:function(c){var b=this._field.types();b.splice(0,1);b.push(b[0].map(function(){return C.CellType.None}));this._field.types(b);this.emit(C.Constants.Event.Change)},buildUpField:function(c){var b=this._field.types();b.splice(b.length-1,1);b.unshift(b[0].map(function(){return C.CellType.Ojama}));this._field.types(b);this.emit(C.Constants.Event.Change)},selectType:function(b){this._selectedType=b.type;this.emit(C.Constants.Event.Change)},addChangeListener:function(b){this.addListener(C.Constants.Event.Change,b)},removeChangeListener:function(b){this.removeListener(C.Constants.Event.Change,b)},addSetUrlListener:function(b){this.addListener(C.Constants.Event.SetUrl,b)},removeSetUrlListener:function(b){this.removeListener(C.Constants.Event.SetUrl,b)},addChangeModeListener:function(b){this.addListener(C.Constants.Event.ChangeMode,b)},removeChangeModeListener:function(b){this.removeListener(C.Constants.Event.ChangeMode,b)},},C.StoreBase);C.AppDispatcher.register(function(c){var b=c.action;switch(b.actionType){case C.Constants.Action.Edit.Initialize:a.initialize(b);break;case C.Constants.Action.Edit.BackNext:a.backNext(b);break;case C.Constants.Action.Edit.BeginSetCell:a.beginSetCell(b);break;case C.Constants.Action.Edit.BuildDownField:a.buildDownField(b);break;case C.Constants.Action.Edit.BuildUpField:a.buildUpField(b);break;case C.Constants.Action.Edit.Cancel:a.cancel(b);break;case C.Constants.Action.Edit.Clear:a.clear(b);break;case C.Constants.Action.Edit.CreateUrlParameters:a.createUrlParameters(b);break;case C.Constants.Action.Edit.ChangeModeToSimu:a.changeModeToSimu(b);break;case C.Constants.Action.Edit.DeleteNext:a.deleteNext(b);break;case C.Constants.Action.Edit.EndSetCell:a.endSetCell(b);break;case C.Constants.Action.Edit.ForwardNext:a.forwardNext(b);break;case C.Constants.Action.Edit.InsertNext:a.insertNext(b);break;case C.Constants.Action.Edit.SelectType:a.selectType(b);break;case C.Constants.Action.Edit.SetCell:a.setCell(b);break;case C.Constants.Action.Edit.SetHold:a.setHold(b);break;case C.Constants.Action.Edit.SetNext:a.setNext(b);break;default:break}return true});C.EditStore=a})();(function(){var a=$.extend({_state:{lButtonDown:false,},state:function(){return $.extend(true,{},this._state)},addMouseListener:function(b){this.addListener(C.Constants.Event.Mouse,b)},removeMouseListener:function(b){this.removeListener(C.Constants.Event.Mouse,b)},up:function(c){var b=c.event.which;if(b===C.Constants.MouseButton.Left){this._state.lButtonDown=false;this.emit(C.Constants.Event.Mouse)}},down:function(c){var b=c.event.which;if(b===C.Constants.MouseButton.Left){this._state.lButtonDown=true;this.emit(C.Constants.Event.Mouse)}},},C.StoreBase);C.AppDispatcher.register(function(c){var b=c.action;switch(b.actionType){case C.Constants.Action.Mouse.Up:a.up(b);break;case C.Constants.Action.Mouse.Down:a.down(b);break;default:break}return true});C.MouseStore=a})();(function(){var a=$.extend({_current:null,_context:null,_ghost:null,_field:new C.Field(),_hold:new C.Hold(),_histories:new C.Histories(),_nexts:new C.Nexts(),_nextsVisibled:new C.NextsVisibled(),_description:new C.Description(),_steps:new C.Steps(),_currentStep:null,_urlParameters:"",initialize:function(b){this._context=b.context;this._current=null;this._ghost=null;this._field=new C.Field();this._hold=new C.Hold();this._histories=new C.Histories();this._nexts=new C.Nexts();this._nextsVisibled.deserialize(this._context.nextsVisibled);this._description=new C.Description();this._steps=new C.Steps();this.__currentStep=null;this._urlParameters="";this._init(this._context);this.emit(C.Constants.Event.Change)},_init:function(d){var b,e,c;this._hold.deserialize(d.hold);this._nexts.deserialize(d.nexts);this._steps.deserialize(d.steps);this._field.deserialize(d.field);this._currentStep=this._steps.forward();if(this._forwardCurrent()){this._updateGhost();this._histories.push(this._current,this._field,this._nexts,this._hold,this._description)}},fieldTypes:function(){return this._field.innerTypes()},holdType:function(){return this._hold.type()},nexts:function(){return this._nexts.nextTypes()},nextsVisibled:function(){return this._nextsVisibled.status()},current:function(){return this._current},ghost:function(){return this._ghost},canHold:function(){return this._hold.canExchange()},descriptionData:function(){return this._description.data()},urlParameters:function(){return this._urlParameters},_forwardCurrent:function(){if(this._nexts.length()===0){this._current=null;return false}else{this._current=C.TetriminoFactory.create(this._nexts.next(),this._field.startPivot());return true}},settle:function(){var c,b=C.Constants.SpinType.None;if(this._currentStep.isTSpin){if(this._ghost.canTSpin(this._field)){b=C.Constants.SpinType.TSpin}else{b=C.Constants.SpinType.TSpinMini}}this._field.settle(this._ghost);var c=this._field.clearLine();this._description.clearLineNum(c);this._description.spinType(b);if(c>0){this._description.ren(this._description.ren()+1)}else{this._description.ren(0)}this._description.perfectCleared(this._field.isPerfectCleared());this._hold.release();this._forwardCurrent();this._histories.push(this._current,this._field,this._nexts,this._hold,this._description);this._description.fixData()},hold:function(){var b;b=this._hold.exchange(this._current.type());if(b==C.CellType.None){this._forwardCurrent()}else{this._current=C.TetriminoFactory.create(b,this._field.startPivot())}this._histories.push(this._current,this._field,this._nexts,this._hold,this._description);this._description.spinType(C.Constants.SpinType.None)},back:function(b){var c;if(!this._histories.canBack()){return}this._histories.back();this._currentStep=this._steps.back();c=this._histories.current();this._current=C.TetriminoFactory.create(c.current(),this._field.startPivot());this._field.deserialize(c.field());this._nexts.no(c.nextNo());this._hold.deserialize(c.hold());this._description.current(c.description());this._updateGhost();this.emit(C.Constants.Event.Change)},_updateGhost:function(){var b;if(this._currentStep==null){this._ghost=null;return}this._ghost=this._current.copy();if(this._currentStep.stepType===C.Constants.StepType.Hold){this._ghost=null}else{if(this._currentStep.stepType===C.Constants.StepType.Ojama){throw new Error("not implemented")}else{if(this._currentStep.stepType===C.Constants.StepType.HardDrop){b=this._ghost.pivot();b.x=this._currentStep.pos;this._ghost.pivot(b);this._ghost.direction(this._currentStep.direction);this._ghost.hardDrop(this._field)}else{this._ghost.pivot(this._currentStep.pivot);this._ghost.direction(this._currentStep.direction)}}}},forward:function(b){if(this._currentStep==null){return}if(this._currentStep.stepType===C.Constants.StepType.Hold){this.hold()}else{if(this._currentStep.stepType===C.Constants.StepType.Ojama){throw new Error("not implemented")}else{this.settle()}}this._currentStep=this._steps.forward();this._updateGhost();this.emit(C.Constants.Event.Change)},backToHead:function(b){this.initialize({context:this._context})},createUrlParameters:function(k){var d=this._context,i=[],j=d.field,g=d.nexts,b=this._nextsVisibled.serialize(),c=d.steps,e=d.hold;if(!!j){i.push("f="+j)}if(!!g){i.push("ns="+g)}if(!!b&&b!="v"){i.push("nv="+b)}if(!!c){i.push("ss="+c)}if(!!e){i.push("h="+e)}i.push("m="+C.Constants.Mode.Replay);i.push("v="+C.Constants.Version);this._urlParameters=i.join("&");this.emit(C.Constants.Event.SetUrl)},changeModeToSimu:function(c){var e=C.Constants.Mode.Simu,b=this._context;var d={field:b.field,nexts:b.nexts,nextsVisibled:this._nextsVisibled.serialize(),prevs:b.prevs,hold:b.hold};this.emit(C.Constants.Event.ChangeMode,e,d)},toggleNextVisible:function(b){this._nextsVisibled.toggleVisible(b.index);this.emit(C.Constants.Event.Change)},addChangeListener:function(b){this.addListener(C.Constants.Event.Change,b)},removeChangeListener:function(b){this.removeListener(C.Constants.Event.Change,b)},addSetUrlListener:function(b){this.addListener(C.Constants.Event.SetUrl,b)},removeSetUrlListener:function(b){this.removeListener(C.Constants.Event.SetUrl,b)},addChangeModeListener:function(b){this.addListener(C.Constants.Event.ChangeMode,b)},removeChangeModeListener:function(b){this.removeListener(C.Constants.Event.ChangeMode,b)},},C.StoreBase);C.AppDispatcher.register(function(c){var b=c.action;switch(b.actionType){case C.Constants.Action.Replay.Initialize:a.initialize(b);break;case C.Constants.Action.Replay.Forward:a.forward(b);break;case C.Constants.Action.Replay.Back:a.back(b);break;case C.Constants.Action.Replay.BackToHead:a.backToHead(b);break;case C.Constants.Action.Replay.CreateUrlParameters:a.createUrlParameters(b);break;case C.Constants.Action.Replay.ChangeModeToSimu:a.changeModeToSimu(b);break}return true});C.ReplayStore=a})();(function(){var a=$.extend({_initialized:false,_context:null,_current:null,_ghost:null,_field:new C.Field(),_hold:new C.Hold(),_histories:new C.Histories(),_nexts:new C.Nexts(),_nextsVisibled:new C.NextsVisibled(),_description:new C.Description(),_nextGenerator:new C.NextGenerator(),_steps:new C.Steps(),_seed:0,_urlParameters:"",initialize:function(c,b){if(this._initialized&&!c.context.force){this._context.before=c.context.before;return}this._initialized=true;this._context=c.context;this._seed=this._context.seed==null?C.Random.nextInt(1000000):this._context.seed;this._nextsVisibled.deserialize(this._context.nextsVisibled);this._init(c.context);this.emit(C.Constants.Event.Change)},_init:function(c){var b;this._current=null,this._ghost=null,this._field=new C.Field(),this._hold=new C.Hold(),this._histories=new C.Histories(),this._nexts=new C.Nexts(),this._description=new C.Description(),this._nextGenerator=new C.NextGenerator(),this._steps=new C.Steps(),this._currentStep=null;C.Random.setSeed(this._seed);this._hold.deserialize(c.hold);this._field.deserialize(c.field);this._nexts.deserialize(c.nexts);b=C.NextsDeserializer.deserialize(c.prevs);this._nexts.setAndComplementTypes(this._nexts.types(),b,this._nextGenerator);while(this._nexts.nextsLength()<5){this._nexts.push(this._nextGenerator.next())}this._forwardCurrent();this._histories.push(this._current,this._field,this._nexts,this._hold,this._description)},context:function(){return this._context},retry:function(b){if(b.isSuperRetry){this._seed=C.Random.nextInt(1000000)}this._init(this._context);this.emit(C.Constants.Event.Change)},fieldTypes:function(){return this._field.innerTypes()},holdType:function(){return this._hold.type()},nexts:function(){return this._nexts.nextTypes()},nextsFixed:function(){return this._nexts.nextTypesFixed()},nextsVisibled:function(){return this._nextsVisibled.status()},current:function(){return this._current},ghost:function(){return this._ghost},canHold:function(){return this._hold.canExchange()},descriptionData:function(){return this._description.data()},seed:function(){return this._seed},urlParameters:function(){return this._urlParameters},_forwardCurrent:function(){this._current=C.TetriminoFactory.create(this._nexts.next(),this._field.startPivot());if(this._nexts.nextsLength()<5){this._nexts.push(this._nextGenerator.next())}this._updateGhost()},hardDrop:function(d){var e,c=this._current.pivot().y,b;this._current.hardDrop(this._field);b=this._canHardDropFromStart(this._current);this._field.settle(this._current);if(c!==this._current.pivot().y){this._description.spinType(C.Constants.SpinType.None)}this._steps.forgetAfter();this._steps.pushTetrimino(this._current,this._description.spinType(),b);this._steps.forward();var e=this._field.clearLine();this._description.clearLineNum(e);if(e>0){this._description.ren(this._description.ren()+1)}else{this._description.ren(0)}this._description.perfectCleared(this._field.isPerfectCleared());this._forwardCurrent();this._hold.release();this._histories.push(this._current,this._field,this._nexts,this._hold,this._description);this._description.fixData();this.emit(C.Constants.Event.Change)},_canHardDropFromStart:function(d){var b=d.copy(),c=b.pivot(),f=d.pivot(),e;c.y=this._field.startPivot().y;b.pivot(c);b.hardDrop(this._field);e=b.pivot();return e.x===f.x&&e.y===f.y},softDrop:function(b){if(!this._field.isGround(this._current)){this._current.move({x:0,y:-1});this._description.spinType(C.Constants.SpinType.None)}this.emit(C.Constants.Event.Change)},move:function(b){if(this._current.canMove(this._field,{x:b.sign,y:0})){this._current.move({x:b.sign,y:0});this._description.spinType(C.Constants.SpinType.None);this._updateGhost();this.emit(C.Constants.Event.Change)}},hold:function(b){var c;if(!this._hold.canExchange()){return}this._steps.forgetAfter();this._steps.pushHold(this._current.type());this._steps.forward();c=this._hold.exchange(this._current.type());if(c==C.CellType.None){this._forwardCurrent()}else{this._current=C.TetriminoFactory.create(c,this._field.startPivot())}this._histories.push(this._current,this._field,this._nexts,this._hold,this._description);this._description.spinType(C.Constants.SpinType.None);this._updateGhost();this.emit(C.Constants.Event.Change)},turnLeft:function(c){var b={};if(this._current.turnLeftIfPossible(this._field,b)||this._current.turnLeftSuperlyIfPossible(this._field,b)){this._description.spinType(b.spinType);this._updateGhost();this.emit(C.Constants.Event.Change)}},turnRight:function(c){var b={};if(this._current.turnRightIfPossible(this._field,b)||this._current.turnRightSuperlyIfPossible(this._field,b)){this._description.spinType(b.spinType);this._updateGhost();this.emit(C.Constants.Event.Change)}},forward:function(b){var c;if(!this._histories.canForward()){return}this._histories.forward();this._steps.forward();c=this._histories.current();this._current=C.TetriminoFactory.create(c.current(),this._field.startPivot());this._field.deserialize(c.field());this._nexts.no(c.nextNo());this._hold.deserialize(c.hold());this._description.current(c.description());this._updateGhost();this.emit(C.Constants.Event.Change)},back:function(b){var c;if(!this._histories.canBack()){return}this._histories.back();this._steps.back();c=this._histories.current();this._current=C.TetriminoFactory.create(c.current(),this._field.startPivot());this._field.deserialize(c.field());this._nexts.no(c.nextNo());this._hold.deserialize(c.hold());this._description.current(c.description());this._updateGhost();this.emit(C.Constants.Event.Change)},_updateGhost:function(){this._ghost=this._current.copy();this._ghost.hardDrop(this._field)},createUrlParameters:function(k){var d=this._context,i=[],j=d.field,g=this._nexts.serialize(),b=this._nextsVisibled.serialize(),c=this._steps.serialize(),e=d.hold;if(!!j){i.push("f="+j)}if(!!g){i.push("ns="+g)}if(!!b&&b!="v"){i.push("nv="+b)}if(!!c){i.push("ss="+c)}if(!!e){i.push("h="+e)}i.push("m="+C.Constants.Mode.Replay);i.push("v="+C.Constants.Version);this._urlParameters=i.join("&");this.emit(C.Constants.Event.SetUrl)},changeModeToEdit:function(d){var f=C.Constants.Mode.Edit,c=new C.Nexts(),b=this.nexts();b.unshift(this._current.type());c.types(b);var e={before:C.Constants.Mode.Simu,field:this._field.serialize(),force:true,hold:this._hold.serialize(),nexts:c.serialize(),nextsVisibled:this._nextsVisibled.serialize(),prevs:"",};this.emit(C.Constants.Event.ChangeMode,f,e)},backToEditMode:function(b){var c=C.Constants.Mode.Edit;this.emit(C.Constants.Event.ChangeMode,c,{before:C.Constants.Mode.Simu})},changeModeToReplay:function(d){var f=C.Constants.Mode.Replay,b=this._nexts.types(),c=new C.Nexts();c.types(b);var e={before:C.Constants.Mode.Simu,field:this._context.field,hold:this._context.hold,nexts:c.serialize(),nextsVisibled:this._nextsVisibled.serialize(),prevs:"",steps:this._steps.serialize()};this.emit(C.Constants.Event.ChangeMode,f,e)},clear:function(b){var d=C.Constants.Mode.Simu,c={force:true,field:"",hold:"",nexts:"",nextsVisibled:this._nextsVisibled.serialize(),prevs:"",steps:""};this.emit(C.Constants.Event.ChangeMode,d,c)},toggleNextVisible:function(b){this._nextsVisibled.toggleVisible(b.index);this.emit(C.Constants.Event.Change)},addChangeListener:function(b){this.addListener(C.Constants.Event.Change,b)},removeChangeListener:function(b){this.removeListener(C.Constants.Event.Change,b)},addSetUrlListener:function(b){this.addListener(C.Constants.Event.SetUrl,b)},removeSetUrlListener:function(b){this.removeListener(C.Constants.Event.SetUrl,b)},addChangeModeListener:function(b){this.addListener(C.Constants.Event.ChangeMode,b)},removeChangeModeListener:function(b){this.removeListener(C.Constants.Event.ChangeMode,b)},},C.StoreBase);C.AppDispatcher.register(function(c){var b=c.action;switch(b.actionType){case C.Constants.Action.Simu.Initialize:a.initialize(b);break;case C.Constants.Action.Simu.HardDrop:a.hardDrop(b);break;case C.Constants.Action.Simu.SoftDrop:a.softDrop(b);break;case C.Constants.Action.Simu.Move:a.move(b);break;case C.Constants.Action.Simu.Hold:a.hold(b);break;case C.Constants.Action.Simu.TurnRight:a.turnRight(b);break;case C.Constants.Action.Simu.TurnLeft:a.turnLeft(b);break;case C.Constants.Action.Simu.Retry:a.retry(b);break;case C.Constants.Action.Simu.Forward:a.forward(b);break;case C.Constants.Action.Simu.Back:a.back(b);break;case C.Constants.Action.Simu.Clear:a.clear(b);break;case C.Constants.Action.Simu.CreateUrlParameters:a.createUrlParameters(b);break;case C.Constants.Action.Simu.ChangeModeToEdit:a.changeModeToEdit(b);break;case C.Constants.Action.Simu.ChangeModeToReplay:a.changeModeToReplay(b);break;case C.Constants.Action.Simu.BackToEditMode:a.backToEditMode(b);break;case C.Constants.Action.Simu.ToggleNextVisible:a.toggleNextVisible(b);break;default:break}return true});C.SimuStore=a})();(function(){var a={cancel:function(){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Config.CancelConfig})},save:function(b){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Config.StoreConfig,config:b})}};C.ConfigAction=a})();(function(){var a={keydown:function(b){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Controller.KeyDown,keyName:b})},keyup:function(b){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Controller.KeyUp,keyName:b})},};C.ControllerAction=a})();(function(){var a={initialize:function(b){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Edit.Initialize,context:b})},};C.EditPanelAction=a})();(function(){var a={beginEdit:function(b,c){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Edit.BeginSetCell,x:b,y:c,})},buildDown:function(){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Edit.BuildDownField,})},buildUp:function(){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Edit.BuildUpField,})},setCell:function(b,c){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Edit.SetCell,x:b,y:c,})},endEdit:function(){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Edit.EndSetCell,})},};C.FieldEditAction=a})();(function(){var a={SetHold:function(){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Edit.SetHold})}};C.HoldEditAction=a})();(function(){var a={initialize:function(b){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Simu.Initialize,context:b})},storeConfig:function(b){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Config.StoreConfig,config:b})}};C.MainPanelAction=a})();(function(){var a={down:function(b){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Mouse.Down,event:b})},up:function(b){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Mouse.Up,event:b})},};C.MouseAction=a})();(function(){var a={back:function(){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Edit.BackNext,})},deleteNext:function(b){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Edit.DeleteNext,index:b,})},forward:function(){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Edit.ForwardNext,})},insertNext:function(b){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Edit.InsertNext,index:b,})},setNext:function(b){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Edit.SetNext,index:b})}};C.NextEditAction=a})();(function(){var a={};C.NextReplayAction=a})();(function(){var a={toggleNextVisible:function(b){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Simu.ToggleNextVisible,index:b,})},};C.NextSimuAction=a})();(function(){var a={cancel:function(){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Edit.Cancel})},changeModeToSimu:function(b){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Edit.ChangeModeToSimu,context:b})},clear:function(){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Edit.Clear})},createUrlParameters:function(b){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Edit.CreateUrlParameters,context:b})},fieldUp:function(){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Edit.BuildUpField,})},fieldDown:function(){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Edit.BuildDownField,})},nextUp:function(){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Edit.BackNext,})},nextDown:function(){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Edit.ForwardNext,})},selectType:function(b){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Edit.SelectType,type:b})},setHold:function(){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Edit.SetHold,})},};C.OperationEditPanelAction=a})();(function(){var a={forward:function(){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Replay.Forward})},back:function(){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Replay.Back})},backToHead:function(){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Replay.BackToHead,})},createUrlParameters:function(){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Replay.CreateUrlParameters,})},changeModeToSimu:function(){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Replay.ChangeModeToSimu,})}};C.OperationReplayPanelAction=a})();(function(){var a={hardDrop:function(){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Simu.HardDrop})},softDrop:function(){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Simu.SoftDrop})},leftMove:function(){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Simu.Move,sign:-1})},rightMove:function(){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Simu.Move,sign:1})},hold:function(){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Simu.Hold})},turnRight:function(){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Simu.TurnRight})},turnLeft:function(){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Simu.TurnLeft})},retry:function(b){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Simu.Retry,isSuperRetry:b})},back:function(){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Simu.Back})},forward:function(){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Simu.Forward})},clear:function(){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Simu.Clear})},createUrlParameters:function(){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Simu.CreateUrlParameters})},changeModeToEdit:function(){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Simu.ChangeModeToEdit,})},changeModeToReplay:function(){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Simu.ChangeModeToReplay,})},backToEditMode:function(){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Simu.BackToEditMode,})},};C.OperationSimuPanelAction=a})();(function(){var a={initialize:function(b){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Replay.Initialize,context:b})},};C.ReplayPanelAction=a})();(function(){var a={initialize:function(b){C.AppDispatcher.handleViewAction({actionType:C.Constants.Action.Simu.Initialize,context:b})},};C.SimuPanelAction=a})();var ConfigPanel=React.createClass({displayName:"ConfigPanel",_KeyCombos:[],getInitialState:function(){return{config:C.ConfigStore.config(),errorMessages:[]}},componentWillMount:function(){},componentDidMount:function(){C.ControllerStore.addKeyListener(this.onKey)},componentWillUnmount:function(){C.ControllerStore.removeKeyListener(this.onKey)},render:function(){var a=this._makeKeyConfigItems([{actionName:"ハードドロップ",action:"hardDrop"},{actionName:"ソフトロップ",action:"softDrop"},{actionName:"左移動",action:"leftMove"},{actionName:"右移動",action:"rightMove"},{actionName:"左回転",action:"turnLeft"},{actionName:"右回転",action:"turnRight"},{actionName:"ホールド",action:"hold"},{actionName:"１手進む",action:"forward"},{actionName:"１手戻る",action:"back"},{actionName:"リトライ",action:"retry"},{actionName:"スーパーリトライ",action:"superRetry"},{actionName:"クリア",action:"clear"},{actionName:"モード切替(Replay)",action:"changeModeToReplay"},{actionName:"モード切替(Edit)",action:"changeModeToEdit"},{actionName:"戻る",action:"backToEditMode"},{actionName:"URL出力",action:"createUrlParameters"},{actionName:"設定",action:"configure"}],this.state.config.key.simu);var b=this._makeKeyConfigItems([{actionName:"１手進む",action:"forward"},{actionName:"１手戻る",action:"back"},{actionName:"最初に戻る",action:"backToHead"},{actionName:"モード切替(Simu)",action:"changeModeToSimu"},{actionName:"戻る",action:"cancel"},{actionName:"URL出力",action:"createUrlParameters"},{actionName:"設定",action:"configure"}],this.state.config.key.replay);var c=this._makeKeyConfigItems([{actionName:"Iを選択",action:"selectTypeI"},{actionName:"Jを選択",action:"selectTypeJ"},{actionName:"Lを選択",action:"selectTypeL"},{actionName:"Oを選択",action:"selectTypeO"},{actionName:"Sを選択",action:"selectTypeS"},{actionName:"Tを選択",action:"selectTypeT"},{actionName:"Zを選択",action:"selectTypeZ"},{actionName:"白を選択",action:"selectTypeOjama"},{actionName:"黒を選択",action:"selectTypeNone"},{actionName:"ホールドを設定",action:"setHold"},{actionName:"クリア",action:"clear"},{actionName:"モード切り替え(Simu)",action:"changeModeToSimu"},{actionName:"戻る",action:"cancel"},{actionName:"URL出力",action:"createUrlParameters"},{actionName:"設定",action:"configure"}],this.state.config.key.edit);return React.createElement("div",{className:"config-panel"},React.createElement("div",{className:"inner-config-panel"},React.createElement(ModeConfig,{prefixId:"simu",config:this.state.config.simu,title:"Simu",configItems:a,ref:"simu"}),React.createElement("hr",{style:{clear:"both"}}),React.createElement(ModeConfig,{prefixId:"replay",config:this.state.config.replay,title:"Replay",configItems:b,ref:"replay"}),React.createElement("hr",{style:{clear:"both"}}),React.createElement(ModeConfig,{prefixId:"edit",config:this.state.config.edit,title:"Edit",configItems:c,ref:"edit"}),React.createElement("hr",{style:{clear:"both"}}),React.createElement("div",{className:"config-button-area"},React.createElement("button",{onClick:this.onSave},"保存"),React.createElement("button",{onClick:this.onCancel},"キャンセル"),React.createElement("button",{onClick:this.onInitialize},"初期設定に戻す"))),React.createElement("div",{className:"config-error"},this.state.errorMessages.map(function(d){return React.createElement("div",null,d)})))},_makeKeyConfigItems:function(g,a){var l,f,b,d,n,o,m,c,h,k,e=[];for(f=0,len=g.length;f<len;f++){o=g[f];k=$.extend({},{no:f,shift:false,ctrl:false,cmd:false,action:o.action,actionName:o.actionName});m=a[o.action];h=m.split("+");for(d=0,n=h.length;d<n;d++){c=h[d].trim();switch(c){case"shift":k.shift=true;break;case"ctrl":k.ctrl=true;break;case"cmd":k.cmd=true;break;default:k.keyName=c;break}}e.push(k)}return e},onKey:function(a){if(a.keyName==="esc"){this._closeConfig(a)}},_closeConfig:function(a){if(a.down){this.onCancel()}},onSave:function(){var a={errorMessages:[]},b;b=this._buildNewConfig(a);if(b){this._save(b)}else{this.setState({errorMessages:a.errorMessages})}},_save:function(a){C.ConfigAction.save(a);localStorage.setItem("config",JSON.stringify(a))},_buildNewConfig:function(a){var b={},d=this.refs.simu.buildConfig(),e=this.refs.replay.buildConfig(),c=this.refs.edit.buildConfig();this._validateConfig("Simu",d.keysBeforeShifted,a);this._validateConfig("Replay",e.keysBeforeShifted,a);this._validateConfig("Edit",c.keysBeforeShifted,a);if(a.errorMessages.length>0){return null}b={version:C.Constants.ConfigVersion,key:{simu:d.keys,replay:e.keys,edit:c.keys,}};return b},_validateConfig:function(d,c,a){var g,e,f={},b={},h=[];for(g in c){e=c[g];if((e!=="")&&(e in f)&&!(e in b)){b[e]=true;h.push(e+"が重複しています。")}f[e]=true}if(h.length>0){h=[d,"-------------------------"].concat(h).concat([" "]);a.errorMessages=a.errorMessages.concat(h);return false}return true},_makeComboKeyName:function(a){var b=[]},onCancel:function(){C.ConfigAction.cancel()},onInitialize:function(){if(confirm("初期設定に戻します。よろしいですか？")){this._save(C.ConfigStore.defaultConfig())}}});var KeyConfigItem=React.createClass({displayName:"KeyConfigItem",_KeyDefinitions:[{label:"設定なし",value:""},{label:"space",value:"space"},{label:"left",value:"left"},{label:"up",value:"up"},{label:"right",value:"right"},{label:"down",value:"down"},{label:"0",value:"0",shift:")"},{label:"1",value:"1",shift:"!"},{label:"2",value:"2",shift:"@"},{label:"3",value:"3",shift:"#"},{label:"4",value:"4",shift:"$"},{label:"5",value:"5",shift:"%"},{label:"6",value:"6",shift:"^"},{label:"7",value:"7",shift:"&"},{label:"8",value:"8",shift:"*"},{label:"9",value:"9",shift:"("},{label:"a",value:"a"},{label:"b",value:"b"},{label:"c",value:"c"},{label:"d",value:"d"},{label:"e",value:"e"},{label:"f",value:"f"},{label:"g",value:"g"},{label:"h",value:"h"},{label:"i",value:"i"},{label:"j",value:"j"},{label:"k",value:"k"},{label:"l",value:"l"},{label:"m",value:"m"},{label:"n",value:"n"},{label:"o",value:"o"},{label:"p",value:"p"},{label:"q",value:"q"},{label:"r",value:"r"},{label:"s",value:"s"},{label:"t",value:"t"},{label:"u",value:"u"},{label:"v",value:"v"},{label:"w",value:"w"},{label:"x",value:"x"},{label:"y",value:"y"},{label:"z",value:"z"},{label:"num_0",value:"num_0"},{label:"num_1",value:"num_1"},{label:"num_2",value:"num_2"},{label:"num_3",value:"num_3"},{label:"num_4",value:"num_4"},{label:"num_5",value:"num_5"},{label:"num_6",value:"num_6"},{label:"num_7",value:"num_7"},{label:"num_8",value:"num_8"},{label:"num_9",value:"num_9"},{label:";",value:";",shift:":"},{label:",",value:",",shift:"<"},{label:".",value:".",shift:">"},{label:"/",value:"/",shift:"?"},{label:"Esc",value:"esc"},],render:function(){var e=this.props.value,g=this.props.value.no,f=this.props.prefixId+"-key-"+g,h=this.props.prefixId+"-shift-"+g,a=this.props.prefixId+"-ctrl-"+g,i=this.props.prefixId+"-cmd-"+g,b=e.shift,d=e.keyName,c;c=$.grep(this._KeyDefinitions,function(j){return j.shift===e.keyName});if(c.length!==0){d=c[0].value;b=true}return React.createElement("li",{className:"config-item","data-no":g},React.createElement("div",{className:"title"},e.actionName),React.createElement("div",null,React.createElement("select",{id:f,defaultValue:d},this._KeyDefinitions.map(function(j,k){if(j.shift==null){return React.createElement("option",{value:j.value,key:j.label},j.label)}else{return React.createElement("option",{value:j.value,key:j.label,"data-shift":j.shift},j.label)}})),React.createElement("input",{id:h,type:"checkbox",defaultChecked:b}),React.createElement("label",{htmlFor:h},"shift"),React.createElement("input",{id:a,type:"checkbox",defaultChecked:e.ctrl}),React.createElement("label",{htmlFor:a},"ctrl"),React.createElement("input",{id:i,type:"checkbox",defaultChecked:e.cmd}),React.createElement("label",{htmlFor:i},"cmd")))},buildConfig:function(){var g=this.props.value,k=this.props.value.no,j="#"+this.props.prefixId+"-key-"+k,l="#"+this.props.prefixId+"-shift-"+k,d="#"+this.props.prefixId+"-ctrl-"+k,m="#"+this.props.prefixId+"-cmd-"+k,b=$(l).is(":checked"),a=$(d).is(":checked"),c=$(m).is(":checked"),i=$(j).val(),f=$(j).find("option:selected").attr("data-shift"),h=[],e=[];if(i===""){return{actionName:this.props.value.action,key:"",keyBeforeShifted:""}}if(a){h.push("ctrl");e.push("ctrl")}if(b&&!f){h.push("shift");e.push("shift")}else{if(b){e.push("shift")}}if(c){h.push("cmd");e.push("cmd")}e.push(i);if(b&&!!f){h.push(f)}else{h.push(i)}return{actionName:this.props.value.action,key:h.join(" + "),keyBeforeShifted:e.join(" + ")}}});var ModeConfig=React.createClass({displayName:"ModeConfig",render:function(){var a=this;return React.createElement("div",{id:this.props.prefixId+"-config"},React.createElement("div",{className:"config-title"},this.props.title),React.createElement("ul",{className:"config-list"},this.props.configItems.map(function(c,b){return React.createElement(KeyConfigItem,{prefixId:a.props.prefixId,no:b,value:c,ref:"keyConfigItem"+b,key:c.action})})))},buildConfig:function(){var c=0,b,a={keys:{},keysBeforeShifted:{}};while(this.refs["keyConfigItem"+c]!==undefined){b=this.refs["keyConfigItem"+c].buildConfig();a.keys[b.actionName]=b.key;a.keysBeforeShifted[b.actionName]=b.keyBeforeShifted;c++}return a}});var DescriptionReplayPanel=React.createClass({displayName:"DescriptionReplayPanel",_TrickNames:(function(){var a={};a[C.Constants.Trick.None]="";a[C.Constants.Trick.Single]="Single";a[C.Constants.Trick.Double]="Double";a[C.Constants.Trick.Triple]="Triple";a[C.Constants.Trick.Tetris]="Tetris";a[C.Constants.Trick.TSSM]="TSpin Single Mini";a[C.Constants.Trick.TSS]="TSpin Single";a[C.Constants.Trick.TSD]="TSpin Double";a[C.Constants.Trick.TST]="TSpin Triple";a[C.Constants.Trick.TSM]="TSpin Mini";a[C.Constants.Trick.TS]="TSpin";a[C.Constants.Trick.OverTetris]="Over Tetris";return a})(),getInitialState:function(){return{data:C.ReplayStore.descriptionData()}},componentDidMount:function(){C.ReplayStore.addChangeListener(this.onChange)},componentWillUnmount:function(){C.ReplayStore.removeChangeListener(this.onChange)},onChange:function(){this.setState({data:C.ReplayStore.descriptionData()})},render:function(){var c=[],b=this.state.data,a="";c.push(React.createElement("p",{key:"ren"},"REN: "+b.ren));if(b.trick!==C.Constants.Trick.None){a=this._TrickNames[b.trick];if(b.b2b){a="BtoB "+a}c.push(React.createElement("p",{key:"trick"},a))}if(b.perfectCleared){c.push(React.createElement("p",{key:"pc"},"Perfect Clear"))}return React.createElement("div",{className:"description-panel"},c)}});var DescriptionSimuPanel=React.createClass({displayName:"DescriptionSimuPanel",_TrickNames:(function(){var a={};a[C.Constants.Trick.None]="";a[C.Constants.Trick.Single]="Single";a[C.Constants.Trick.Double]="Double";a[C.Constants.Trick.Triple]="Triple";a[C.Constants.Trick.Tetris]="Tetris";a[C.Constants.Trick.TSSM]="TSpin Single Mini";a[C.Constants.Trick.TSS]="TSpin Single";a[C.Constants.Trick.TSD]="TSpin Double";a[C.Constants.Trick.TST]="TSpin Triple";a[C.Constants.Trick.TSM]="TSpin Mini";a[C.Constants.Trick.TS]="TSpin";a[C.Constants.Trick.OverTetris]="Over Tetris";return a})(),getInitialState:function(){return{data:C.SimuStore.descriptionData()}},componentDidMount:function(){C.SimuStore.addChangeListener(this.onChange)},componentWillUnmount:function(){C.SimuStore.removeChangeListener(this.onChange)},onChange:function(){this.setState({data:C.SimuStore.descriptionData()})},render:function(){var c=[],b=this.state.data,a="";c.push(React.createElement("p",{key:"ren"},"REN: "+b.ren));if(b.trick!==C.Constants.Trick.None){a=this._TrickNames[b.trick];if(b.b2b){a="BtoB "+a}c.push(React.createElement("p",{key:"trick"},a))}if(b.perfectCleared){c.push(React.createElement("p",{key:"pc"},"Perfect Clear"))}return React.createElement("div",{className:"description-panel"},c)}});var EditPanel=React.createClass({displayName:"EditPanel",componentWillMount:function(){C.EditPanelAction.initialize(this.props.context)},componentWillReceiveProps:function(a){C.EditPanelAction.initialize(a.context)},render:function(){return React.createElement("div",{className:"main-panel"},React.createElement(LeftEditPanel,null),React.createElement(FieldEditPanel,null),React.createElement(NextEditPanel,null),React.createElement(OperationEditPanel,{context:this.props.context}),React.createElement("div",{className:"status"},React.createElement("div",{className:"mode"},"Edit"),React.createElement("div",{className:"version"},"Ver. ",C.Constants.Version)))}});var FieldEditPanel=React.createClass({displayName:"FieldEditPanel",_CellTypeClass:(function(){var a={};a[C.CellType.None]="type-none";a[C.CellType.I]="type-i";a[C.CellType.J]="type-j";a[C.CellType.L]="type-l";a[C.CellType.O]="type-o";a[C.CellType.S]="type-s";a[C.CellType.T]="type-t";a[C.CellType.Z]="type-z";a[C.CellType.Ojama]="type-ojama";a[C.CellType.Wall]="type-wall";return a})(),getInitialState:function(){return{isEditing:C.MouseStore.state().lButtonDown,types:C.EditStore.fieldTypes(),}},componentDidMount:function(){C.EditStore.addChangeListener(this.onChange);C.MouseStore.addMouseListener(this.onMouseChange)},componentWillUnmount:function(){C.EditStore.removeChangeListener(this.onChange);C.MouseStore.removeMouseListener(this.onMouseChange)},onMouseChange:function(){this.setState({isEditing:C.MouseStore.state().lButtonDown,})},onChange:function(){this.setState({types:C.EditStore.fieldTypes(),})},onBeginEdit:function(a,b){if(this.state.configuring){return}C.FieldEditAction.beginEdit(a,b)},onSetCell:function(a,b){if(this.state.configuring||!this.state.isEditing){return}C.FieldEditAction.setCell(a,b)},onEndEdit:function(a,b){if(this.state.configuring||this.state.isEditing){return}C.FieldEditAction.endEdit(a,b)},onBuildUp:function(){if(this.state.configuring){return}C.FieldEditAction.buildUp()},onBuildDown:function(){C.FieldEditAction.buildDown()},onScroll:function(a){if(a<0){this.onBuildUp()}else{this.onBuildDown()}},render:function(){var a=this;return React.createElement("div",{className:"field-edit-panel"},React.createElement("table",{className:"field",onWheel:function(b){a.onScroll(b.deltaY)}},this.state.types.map(function(b,c){return React.createElement("tr",{className:"field-line",key:c},b.map(function(e,d){var f="field-cell";return React.createElement("td",{className:f+" "+a._CellTypeClass[e],key:d,onMouseDown:function(){a.onBeginEdit(d,c)},onMouseOver:function(){a.onSetCell(d,c)},onMouseUp:function(){a.onEndEdit()}})}))}).reverse()),React.createElement("div",{className:"build-blocks"},React.createElement("div",{className:"arrow",onClick:this.onBuildUp},"▲"),React.createElement("div",{className:"arrow",onClick:this.onBuildDown},"▼")))}});var FieldReplayPanel=React.createClass({displayName:"FieldReplayPanel",_CellTypeClass:(function(){var a={};a[C.CellType.None]="type-none";a[C.CellType.I]="type-i";a[C.CellType.J]="type-j";a[C.CellType.L]="type-l";a[C.CellType.O]="type-o";a[C.CellType.S]="type-s";a[C.CellType.T]="type-t";a[C.CellType.Z]="type-z";a[C.CellType.Ojama]="type-ojama";a[C.CellType.Wall]="type-wall";return a})(),getInitialState:function(){return{types:C.ReplayStore.fieldTypes(),current:C.ReplayStore.current(),ghost:C.ReplayStore.ghost()}},componentDidMount:function(){C.ReplayStore.addChangeListener(this.onChange)},componentWillUnmount:function(){C.ReplayStore.removeChangeListener(this.onChange)},onChange:function(){this.setState({types:C.ReplayStore.fieldTypes(),current:C.ReplayStore.current(),ghost:C.ReplayStore.ghost()})},render:function(){var d=this,g,f,c,e,b={},a={};if(this.state.current!=null){f=this.state.current.blocks();for(e in f){g=f[e];b[g.x+":"+g.y]=true}}if(this.state.ghost!=null){c=this.state.ghost.blocks();for(e in c){g=c[e];a[g.x+":"+g.y]=true}}return React.createElement("div",{className:"field-panel"},React.createElement("table",{className:"field"},this.state.types.map(function(h,i){return React.createElement("tr",{className:"field-line",key:i},h.map(function(k,j){var m=j+":"+i,l="field-cell";if(b[m]){return React.createElement("td",{className:l+" "+d._CellTypeClass[d.state.current.type()],key:j})}else{if(a[m]){return React.createElement("td",{className:l+" ghost-cell "+d._CellTypeClass[d.state.current.type()],key:"g"+j})}else{return React.createElement("td",{className:l+" "+d._CellTypeClass[k],key:j})}}}))}).reverse()))}});var FieldSimuPanel=React.createClass({displayName:"FieldSimuPanel",_CellTypeClass:(function(){var a={};a[C.CellType.None]="type-none";a[C.CellType.I]="type-i";a[C.CellType.J]="type-j";a[C.CellType.L]="type-l";a[C.CellType.O]="type-o";a[C.CellType.S]="type-s";a[C.CellType.T]="type-t";a[C.CellType.Z]="type-z";a[C.CellType.Ojama]="type-ojama";a[C.CellType.Wall]="type-wall";return a})(),getInitialState:function(){return{types:C.SimuStore.fieldTypes(),current:C.SimuStore.current(),ghost:C.SimuStore.ghost()}},componentDidMount:function(){C.SimuStore.addChangeListener(this.onChange)},componentWillUnmount:function(){C.SimuStore.removeChangeListener(this.onChange)},onChange:function(){this.setState({types:C.SimuStore.fieldTypes(),current:C.SimuStore.current(),ghost:C.SimuStore.ghost()})},render:function(){var d=this,g,f=this.state.current.blocks(),c=this.state.ghost.blocks(),e,b={},a={};for(e in f){g=f[e];b[g.x+":"+g.y]=true}for(e in c){g=c[e];a[g.x+":"+g.y]=true}return React.createElement("div",{className:"field-panel"},React.createElement("table",{className:"field"},this.state.types.map(function(h,i){return React.createElement("tr",{className:"field-line",key:i},h.map(function(k,j){var m=j+":"+i,l="field-cell";if(b[m]){return React.createElement("td",{className:l+" "+d._CellTypeClass[d.state.current.type()],key:j})}else{if(a[m]){return React.createElement("td",{className:l+" ghost-cell "+d._CellTypeClass[d.state.current.type()],key:"g"+j})}else{return React.createElement("td",{className:l+" "+d._CellTypeClass[k],key:j})}}}))}).reverse()))}});var HoldEditPanel=React.createClass({displayName:"HoldEditPanel",getInitialState:function(){return{type:C.EditStore.holdType(),canHold:C.EditStore.canHold(),}},componentDidMount:function(){C.EditStore.addChangeListener(this.onChange)},componentWillUnmount:function(){C.EditStore.removeChangeListener(this.onChange)},onChange:function(){this.setState({type:C.EditStore.holdType(),canHold:C.EditStore.canHold(),})},onSetHold:function(){C.HoldEditAction.SetHold()},render:function(){var a;if(this.state.canHold){a="hold"}else{a="hold cannot-hold"}return React.createElement("div",{className:"hold-edit-panel"},React.createElement("h1",null,"HOLD"),React.createElement("div",{className:a,onClick:this.onSetHold},React.createElement(Notices,{type:this.state.type})))}});var HoldReplayPanel=React.createClass({displayName:"HoldReplayPanel",getInitialState:function(){return{type:C.ReplayStore.holdType(),canHold:C.ReplayStore.canHold()}},componentDidMount:function(){C.ReplayStore.addChangeListener(this.onChange)},componentWillUnmount:function(){C.ReplayStore.removeChangeListener(this.onChange)},onChange:function(){this.setState({type:C.ReplayStore.holdType(),canHold:C.ReplayStore.canHold()})},render:function(){var a;if(this.state.canHold){a="hold"}else{a="hold cannot-hold"}return React.createElement("div",{className:"hold-panel"},React.createElement("h1",null,"HOLD"),React.createElement("div",{className:a},React.createElement(Notices,{type:this.state.type})))}});var HoldSimuPanel=React.createClass({displayName:"HoldSimuPanel",getInitialState:function(){return{type:C.SimuStore.holdType(),canHold:C.SimuStore.canHold()}},componentDidMount:function(){C.SimuStore.addChangeListener(this.onChange)},componentWillUnmount:function(){C.SimuStore.removeChangeListener(this.onChange)},onChange:function(){this.setState({type:C.SimuStore.holdType(),canHold:C.SimuStore.canHold()})},render:function(){var a;if(this.state.canHold){a="hold"}else{a="hold cannot-hold"}return React.createElement("div",{className:"hold-panel"},React.createElement("h1",null,"HOLD"),React.createElement("div",{className:a},React.createElement(Notices,{type:this.state.type})))}});var LeftEditPanel=React.createClass({displayName:"LeftEditPanel",render:function(){return React.createElement("div",{className:"left-panel"},React.createElement(HoldEditPanel,null),React.createElement("div",{className:"description-panel"}))}});var LeftReplayPanel=React.createClass({displayName:"LeftReplayPanel",render:function(){return React.createElement("div",{className:"left-panel"},React.createElement(HoldReplayPanel,null),React.createElement(DescriptionReplayPanel,null))}});var LeftSimuPanel=React.createClass({displayName:"LeftSimuPanel",render:function(){return React.createElement("div",{className:"left-panel"},React.createElement(HoldSimuPanel,null),React.createElement(DescriptionSimuPanel,null))}});var MainPanel=React.createClass({displayName:"MainPanel",_KeyCombos:[],onChangeMode:function(b,a){this.setState({context:a,mode:b})},componentWillMount:function(){var b;C.keyListener=new keypress.Listener();var a=C.UrlParameter.parse(location.href);b=C.ContextBuilder.build(a);this.setState({context:b,mode:b.initialMode})},componentDidMount:function(){this._initController();this._initMouse();this._restoreConfig();C.SimuStore.addChangeModeListener(this.onChangeMode);C.ReplayStore.addChangeModeListener(this.onChangeMode);C.EditStore.addChangeModeListener(this.onChangeMode)},_initController:function(){var c=C.Constants.KeyNames,b,a;for(b=0,a=c.length;b<a;b++){this._KeyCombos.push((function(){var d=c[b];return{keys:d,on_keydown:function(){C.ControllerAction.keydown(d);return true},on_keyup:function(){C.ControllerAction.keyup(d);return true}}})())}C.keyListener.register_many(this._KeyCombos)},_initMouse:function(){$(document).mousedown(function(a){C.MouseAction.down(a)});$(document).mouseup(function(a){C.MouseAction.up(a)})},_restoreConfig:function(){var d,b=null,a=C.ConfigStore.defaultConfig();try{d=localStorage.getItem("config");if(d!=null){b=JSON.parse(d);b.version=C.Constants.ConfigVersion;b.key.simu=this._mergeKeys(a.key.simu,b.key.simu);b.key.replay=this._mergeKeys(a.key.replay,b.key.replay);b.key.edit=this._mergeKeys(a.key.edit,b.key.edit)}}catch(c){console.error(c)}if(!b){b=C.ConfigStore.defaultConfig()}localStorage.setItem("config",JSON.stringify(b));C.MainPanelAction.storeConfig(b)},_mergeKeys:function(a,b){var c;for(c in ($.extend({},b))){if(!(c in a)){delete b[c]}}return $.extend({},a,b)},componentWillUnmount:function(){C.keyListener.unregister_many(this._KeyCombos);C.SimuStore.addChangeModeListener(this.onChangeMode);C.ReplayStore.addChangeModeListener(this.onChangeMode);C.EditStore.addChangeModeListener(this.onChangeMode)},render:function(){$("body").focus();if(this.state.mode===C.Constants.Mode.Simu){return React.createElement(SimuPanel,{context:this.state.context})}if(this.state.mode===C.Constants.Mode.Replay){return React.createElement(ReplayPanel,{context:this.state.context})}if(this.state.mode===C.Constants.Mode.Edit){return React.createElement(EditPanel,{context:this.state.context})}return React.createElement("div",null)}});var NextEditPanel=React.createClass({displayName:"NextEditPanel",getInitialState:function(){return{index:C.EditStore.NextIndex(),prevs:C.EditStore.nexts().prevs,nexts:C.EditStore.nexts().nexts,}},componentDidMount:function(){C.EditStore.addChangeListener(this.onChange)},componentWillUnmount:function(){C.EditStore.removeChangeListener(this.onChange)},onChange:function(){this.setState({index:C.EditStore.NextIndex(),prevs:C.EditStore.nexts().prevs,nexts:C.EditStore.nexts().nexts})},onBack:function(){if(this.state.index<-5){return}C.NextEditAction.back()},onForward:function(){C.NextEditAction.forward()},onScroll:function(a){if(a<0){this.onBack()}else{this.onForward()}},render:function(){var f=this,b=this.state.index,d,c=[],e,a;if(b<0){e=-(b+5);if(e<0){e=0}a=-(b+1);for(d=e,count=0;d<=a;d++,count++){c.push(React.createElement(NextEditItem,{type:this.state.prevs[d],index:-(d+1),isPrev:true}))}c=c.reverse();e=0;a=(b+5-1);for(d=e;d<=a;d++){c.push(React.createElement(NextEditItem,{type:this.state.nexts[d],index:d,isPrev:false}))}}else{for(d=b;d<b+5;d++){c.push(React.createElement(NextEditItem,{type:this.state.nexts[d],index:d,isPrev:false}))}}return React.createElement("div",{className:"next-panel",onWheel:function(g){f.onScroll(g.deltaY)}},React.createElement("h1",null,"NEXT"),React.createElement("a",{href:"javascript:void(0)",className:"arrow"+((this.state.index<-5)?" invisible":""),onClick:this.onBack},"▲"),c,React.createElement("a",{href:"javascript:void(0)",className:"arrow",onClick:this.onForward},"▼"))}});var NextEditItem=React.createClass({displayName:"NextEditItem",getInitialState:function(){return{menuExpanded:false,}},componentWillReceiveProps:function(a){this.setState({menuExpanded:false,})},setNext:function(a){C.NextEditAction.setNext(a)},onMenuExpand:function(){this.setState({menuExpanded:true})},onMenuContraction:function(){this.setState({menuExpanded:false})},onInsert:function(a){C.NextEditAction.insertNext(a)},onDelete:function(a){C.NextEditAction.deleteNext(a)},render:function(){var a=this;return React.createElement("div",{className:"next-edit"},this.props.isPrev?React.createElement("div",{className:"prev-index"},-this.props.index):React.createElement("div",{className:"index",onClick:this.onMenuExpand,onMouseLeave:this.onMenuContraction},this.props.index+1,React.createElement("div",{className:"menu"+(a.state.menuExpanded?"":" none")},React.createElement("div",{className:"menuItem",onClick:function(){a.onInsert(a.props.index)}},"＋"),React.createElement("div",{className:"menuItem",onClick:function(){a.onDelete(a.props.index)}},"－"))),React.createElement("div",{className:"next",onClick:function(){a.setNext(a.props.index)}},React.createElement(Notices,{type:this.props.type})))}});var NextItem=React.createClass({displayName:"NextItem",onToggleVisible:function(){C.NextItemAction.toggleNextVisible(this.props.index)},render:function(){var a=this;if(this.props.visible){return React.createElement("div",{className:"next"+(this.props.fixed?" fixed":""),onClick:a.onToggleVisible},React.createElement(Notices,{type:this.props.type}))}else{return React.createElement("div",{className:"next-hidden",onClick:a.onToggleVisible})}}});var NextReplayPanel=React.createClass({displayName:"NextReplayPanel",getInitialState:function(){return{nexts:C.ReplayStore.nexts(),nextsVisibled:C.ReplayStore.nextsVisibled(),}},componentDidMount:function(){C.ReplayStore.addChangeListener(this.onChange)},componentWillUnmount:function(){C.ReplayStore.removeChangeListener(this.onChange)},onChange:function(){this.setState({nexts:C.ReplayStore.nexts(),nextsVisibled:C.ReplayStore.nextsVisibled(),})},render:function(){return React.createElement("div",{className:"next-panel"},React.createElement("h1",null,"NEXT"),React.createElement(NextItemReplay,{type:this.state.nexts[0],index:"0",visible:!!this.state.nextsVisibled[0]}),React.createElement(NextItemReplay,{type:this.state.nexts[1],index:"1",visible:!!this.state.nextsVisibled[1]}),React.createElement(NextItemReplay,{type:this.state.nexts[2],index:"2",visible:!!this.state.nextsVisibled[2]}),React.createElement(NextItemReplay,{type:this.state.nexts[3],index:"3",visible:!!this.state.nextsVisibled[3]}),React.createElement(NextItemReplay,{type:this.state.nexts[4],index:"4",visible:!!this.state.nextsVisibled[4]}))}});var NextItemReplay=React.createClass({displayName:"NextItemReplay",render:function(){var a=this;if(this.props.visible){return React.createElement("div",{className:"next-replay"},React.createElement("div",{className:"next"+(this.props.fixed?" fixed":"")},React.createElement(Notices,{type:this.props.type})))}else{return React.createElement("div",{className:"next-replay"},React.createElement("div",{className:"next-hidden"}))}}});var NextSimuPanel=React.createClass({displayName:"NextSimuPanel",getInitialState:function(){return{nexts:C.SimuStore.nexts(),nextsFixed:C.SimuStore.nextsFixed(),nextsVisibled:C.SimuStore.nextsVisibled(),}},componentDidMount:function(){C.SimuStore.addChangeListener(this.onChange)},componentWillUnmount:function(){C.SimuStore.removeChangeListener(this.onChange)},onChange:function(){this.setState({nexts:C.SimuStore.nexts(),nextsFixed:C.SimuStore.nextsFixed(),nextsVisibled:C.SimuStore.nextsVisibled(),})},render:function(){return React.createElement("div",{className:"next-panel"},React.createElement("h1",null,"NEXT"),React.createElement(NextItemSimu,{type:this.state.nexts[0],fixed:!!this.state.nextsFixed[0],index:"0",visible:!!this.state.nextsVisibled[0]}),React.createElement(NextItemSimu,{type:this.state.nexts[1],fixed:!!this.state.nextsFixed[1],index:"1",visible:!!this.state.nextsVisibled[1]}),React.createElement(NextItemSimu,{type:this.state.nexts[2],fixed:!!this.state.nextsFixed[2],index:"2",visible:!!this.state.nextsVisibled[2]}),React.createElement(NextItemSimu,{type:this.state.nexts[3],fixed:!!this.state.nextsFixed[3],index:"3",visible:!!this.state.nextsVisibled[3]}),React.createElement(NextItemSimu,{type:this.state.nexts[4],fixed:!!this.state.nextsFixed[4],index:"4",visible:!!this.state.nextsVisibled[4]}))}});var NextItemSimu=React.createClass({displayName:"NextItemSimu",onToggleVisible:function(){C.NextSimuAction.toggleNextVisible(this.props.index)},render:function(){var a=this;if(this.props.visible){return React.createElement("div",{className:"next-simu"},React.createElement("div",{className:"next"+(this.props.fixed?" fixed":""),onClick:a.onToggleVisible},React.createElement(Notices,{type:this.props.type})))}else{return React.createElement("div",{className:"next-simu"},React.createElement("div",{className:"next-hidden",onClick:a.onToggleVisible}))}}});var Notices=React.createClass({displayName:"Notices",render:function(){switch(this.props.type){case undefined:return React.createElement(NoticeNone,null);case C.CellType.None:return React.createElement(NoticeNone,null);case C.CellType.I:return React.createElement(NoticeI,null);case C.CellType.J:return React.createElement(NoticeJ,null);case C.CellType.L:return React.createElement(NoticeL,null);case C.CellType.O:return React.createElement(NoticeO,null);case C.CellType.S:return React.createElement(NoticeS,null);case C.CellType.T:return React.createElement(NoticeT,null);case C.CellType.Z:return React.createElement(NoticeZ,null);default:throw new Error("invalid type("+this.props.type+")")}}});var NoticeNone=React.createClass({displayName:"NoticeNone",render:function(){return React.createElement("table",{className:"notice-none",key:"none"})}});var NoticeI=React.createClass({displayName:"NoticeI",render:function(){return React.createElement("table",{className:"notice-i",key:"i"},React.createElement("tr",null,React.createElement("td",{className:"notice-cell type-i"}),React.createElement("td",{className:"notice-cell type-i"}),React.createElement("td",{className:"notice-cell type-i"}),React.createElement("td",{className:"notice-cell type-i"})))}});var NoticeJ=React.createClass({displayName:"NoticeJ",render:function(){return React.createElement("table",{className:"notice-j",key:"j"},React.createElement("tr",null,React.createElement("td",{className:"notice-cell type-j"}),React.createElement("td",{className:"notice-cell"}),React.createElement("td",{className:"notice-cell"})),React.createElement("tr",null,React.createElement("td",{className:"notice-cell type-j"}),React.createElement("td",{className:"notice-cell type-j"}),React.createElement("td",{className:"notice-cell type-j"})))}});var NoticeL=React.createClass({displayName:"NoticeL",render:function(){return React.createElement("table",{className:"notice-l",key:"l"},React.createElement("tr",null,React.createElement("td",{className:"notice-cell"}),React.createElement("td",{className:"notice-cell"}),React.createElement("td",{className:"notice-cell type-l"})),React.createElement("tr",null,React.createElement("td",{className:"notice-cell type-l"}),React.createElement("td",{className:"notice-cell type-l"}),React.createElement("td",{className:"notice-cell type-l"})))}});var NoticeO=React.createClass({displayName:"NoticeO",render:function(){return React.createElement("table",{className:"notice-o",key:"o"},React.createElement("tr",null,React.createElement("td",{className:"notice-cell type-o"}),React.createElement("td",{className:"notice-cell type-o"})),React.createElement("tr",null,React.createElement("td",{className:"notice-cell type-o"}),React.createElement("td",{className:"notice-cell type-o"})))}});var NoticeS=React.createClass({displayName:"NoticeS",render:function(){return React.createElement("table",{className:"notice-s",key:"s"},React.createElement("tr",null,React.createElement("td",{className:"notice-cell"}),React.createElement("td",{className:"notice-cell type-s"}),React.createElement("td",{className:"notice-cell type-s"})),React.createElement("tr",null,React.createElement("td",{className:"notice-cell type-s"}),React.createElement("td",{className:"notice-cell type-s"}),React.createElement("td",{className:"notice-cell"})))}});var NoticeT=React.createClass({displayName:"NoticeT",render:function(){return React.createElement("table",{className:"notice-t",key:"t"},React.createElement("tr",null,React.createElement("td",{className:"notice-cell"}),React.createElement("td",{className:"notice-cell type-t"}),React.createElement("td",{className:"notice-cell"})),React.createElement("tr",null,React.createElement("td",{className:"notice-cell type-t"}),React.createElement("td",{className:"notice-cell type-t"}),React.createElement("td",{className:"notice-cell type-t"})))}});var NoticeZ=React.createClass({displayName:"NoticeZ",render:function(){return React.createElement("table",{className:"notice-z",key:"z"},React.createElement("tr",null,React.createElement("td",{className:"notice-cell type-z"}),React.createElement("td",{className:"notice-cell type-z"}),React.createElement("td",{className:"notice-cell"})),React.createElement("tr",null,React.createElement("td",{className:"notice-cell"}),React.createElement("td",{className:"notice-cell type-z"}),React.createElement("td",{className:"notice-cell type-z"})))}});var OperationEditPanel=React.createClass({displayName:"OperationEditPanel",getInitialState:function(){return{before:C.EditStore.context().before,configuring:false,context:C.EditStore.context(),keyConfig:C.ConfigStore.keyConfig(C.Constants.Mode.Edit),selectedType:C.EditStore.selectedType(),urlParameters:C.EditStore.urlParameters()}},componentDidMount:function(){C.ControllerStore.addKeyListener(this.onKey);C.EditStore.addChangeListener(this.onChange);C.EditStore.addSetUrlListener(this.onSetUrl);C.ConfigStore.addChangeListener(this.onConfigChange);C.ConfigStore.addCancelListener(this.onConfigCancel)},componentWillUnmount:function(){C.ControllerStore.removeKeyListener(this.onKey);C.EditStore.removeChangeListener(this.onChange);C.EditStore.removeSetUrlListener(this.onSetUrl);C.ConfigStore.removeChangeListener(this.onConfigChange);C.ConfigStore.removeCancelListener(this.onConfigCancel)},onChange:function(){this.setState({selectedType:C.EditStore.selectedType(),})},onKey:function(b){if(this.state.configuring){return}var a=this.state.keyConfig[b.keyName];if(a==null){return}this["_"+a](b)},_clear:function(a){if(a.down){this.onClear()}},onClear:function(){if(this.state.configuring){return}C.OperationEditPanelAction.clear()},_back:function(a){if(a.intervalDown){this.onBack()}},onBack:function(){if(this.state.configuring){return}C.OperationEditPanelAction.back()},_forward:function(a){if(a.intervalDown){this.onForward()}},onForward:function(){if(this.state.configuring){return}C.OperationEditPanelAction.forward()},_configure:function(a){if(a.down){this.setState({configuring:true})}},_createUrlParameters:function(a){if(a.down){this.onCreateUrlParameters()}},onCreateUrlParameters:function(){if(this.state.configuring){return}C.OperationEditPanelAction.createUrlParameters()},onConfigure:function(){if(this.state.configuring){return}this.setState({configuring:true})},onSetUrl:function(){this.setState({urlParameters:C.EditStore.urlParameters()});setTimeout(function(){$("#url-output").select()},0)},_changeModeToSimu:function(a){if(a.down){this.onChangeModeToSimu()}},onChangeModeToSimu:function(){if(this.state.configuring){return}C.OperationEditPanelAction.changeModeToSimu()},_cancel:function(a){if(a.down){this.onCancel()}},onCancel:function(){if(this.state.configuring||!this.state.before){return}C.OperationEditPanelAction.cancel()},onConfigChange:function(){this.setState({configuring:false,keyConfig:C.ConfigStore.keyConfig(C.Constants.Mode.Edit)})},onConfigCancel:function(){this.setState({configuring:false})},onSelectType:function(a){if(this.state.configuring||a===this.state.selectedType){return}C.OperationEditPanelAction.selectType(a)},_selectTypeI:function(a){if(a.down){this.onSelectType(C.CellType.I)}},_selectTypeJ:function(a){if(a.down){this.onSelectType(C.CellType.J)}},_selectTypeL:function(a){if(a.down){this.onSelectType(C.CellType.L)}},_selectTypeO:function(a){if(a.down){this.onSelectType(C.CellType.O)}},_selectTypeS:function(a){if(a.down){this.onSelectType(C.CellType.S)}},_selectTypeT:function(a){if(a.down){this.onSelectType(C.CellType.T)}},_selectTypeZ:function(a){if(a.down){this.onSelectType(C.CellType.Z)}},_selectTypeOjama:function(a){if(a.down){this.onSelectType(C.CellType.Ojama)}},_selectTypeNone:function(a){if(a.down){this.onSelectType(C.CellType.None)}},_fieldUp:function(a){if(a.intervalDown){this.onFieldUp()}},onFieldUp:function(){if(this.state.configuring){return}C.OperationEditPanelAction.fieldUp()},_fieldDown:function(a){if(a.intervalDown){this.onFieldDown()}},onFieldDown:function(){if(this.state.configuring){return}C.OperationEditPanelAction.fieldDown()},_nextUp:function(a){if(a.intervalDown){this.onNextUp()}},onNextUp:function(){if(this.state.configuring){return}C.OperationEditPanelAction.nextUp()},_nextDown:function(a){if(a.intervalDown){this.onNextDown()}},onNextDown:function(){if(this.state.configuring){return}C.OperationEditPanelAction.nextDown()},_setHold:function(a){if(a.down){this.onSetHold()}},onSetHold:function(){if(this.state.configuring){return}C.OperationEditPanelAction.setHold()},render:function(){var b="",a=this.state.selectedType;if(!!this.state.urlParameters){b=location.href.split("?")[0]+"?"+this.state.urlParameters}return React.createElement("div",{className:"operation-panel"},React.createElement("h1",null,"OPERATION"),React.createElement("div",{className:"operation-mode-panel"},React.createElement("div",{className:"operation-simu-panel"},React.createElement("a",{className:"operation-btn",href:"javascript:void(0)",onClick:this.onClear},"クリア"),React.createElement("div",{className:"operation-sub-title"},"MODE"),React.createElement("a",{className:"operation-btn",href:"javascript:void(0)",onClick:this.onChangeModeToSimu},"Simu"),(!!this.state.before)?React.createElement("a",{className:"operation-btn",href:"javascript:void(0)",onClick:this.onCancel},"戻る"):"",React.createElement("div",{className:"operation-sub-title"},"TOOL"),React.createElement("div",{className:"color-pallet"},this._renderColorPalletItem(C.CellType.I,"type-i","I"),this._renderColorPalletItem(C.CellType.J,"type-j","J"),this._renderColorPalletItem(C.CellType.L,"type-l","L"),this._renderColorPalletItem(C.CellType.O,"type-o","O"),this._renderColorPalletItem(C.CellType.S,"type-s","S"),this._renderColorPalletItem(C.CellType.T,"type-t","T"),this._renderColorPalletItem(C.CellType.Z,"type-z","Z"),this._renderColorPalletItem(C.CellType.Ojama,"type-ojama",""),this._renderColorPalletItem(C.CellType.None,"type-none","")),React.createElement("a",{className:"operation-btn",href:"javascript:void(0)",onClick:this.onCreateUrlParameters},"URL出力"),React.createElement("a",{className:"operation-btn",href:"javascript:void(0)",onClick:this.onConfigure},"設定"),React.createElement("textarea",{id:"url-output",className:"url",readOnly:"true",value:b})),this.state.configuring?React.createElement(ConfigPanel,null):false))},_renderColorPalletItem:function(b,d,a){var c=this;return React.createElement("a",{href:"javascript:void(0)",className:d+((this.state.selectedType==b)?" selected":""),onClick:function(){c.onSelectType(b)}},a)}});var OperationReplayPanel=React.createClass({displayName:"OperationReplayPanel",getInitialState:function(){return{before:this.props.context.before,configuring:false,keyConfig:C.ConfigStore.keyConfig(C.Constants.Mode.Replay),urlParameters:C.ReplayStore.urlParameters()}},componentWillMount:function(){},componentDidMount:function(){C.ControllerStore.addKeyListener(this.onKey);C.ReplayStore.addSetUrlListener(this.onSetUrl);C.ConfigStore.addChangeListener(this.onConfigChange);C.ConfigStore.addCancelListener(this.onConfigCancel)},componentWillUnmount:function(){C.ControllerStore.removeKeyListener(this.onKey);C.ReplayStore.removeSetUrlListener(this.onSetUrl);C.ConfigStore.removeChangeListener(this.onConfigChange);C.ConfigStore.removeCancelListener(this.onConfigCancel)},onKey:function(b){if(this.state.configuring){return}var a=this.state.keyConfig[b.keyName];if(a==null){return}this["_"+a](b)},_forward:function(a){if(a.intervalDown){this.onForward()}},onForward:function(){if(this.state.configuring){return}C.OperationReplayPanelAction.forward()},_back:function(a){if(a.intervalDown){this.onBack()}},onBack:function(){if(this.state.configuring){return}C.OperationReplayPanelAction.back()},_backToHead:function(a){if(a.down){this.onBackToHead()}},onBackToHead:function(){if(this.state.configuring){return}C.OperationReplayPanelAction.backToHead()},onSetUrl:function(){this.setState({urlParameters:C.ReplayStore.urlParameters()});setTimeout(function(){$("#url-output").select()},0)},_createUrlParameters:function(a){if(a.down){this.onCreateUrlParameters()}},onCreateUrlParameters:function(){if(this.state.configuring){return}C.OperationReplayPanelAction.createUrlParameters()},_changeModeToSimu:function(a){if(a.down){this.onChangeModeToSimu()}},onChangeModeToSimu:function(){if(this.state.configuring){return}C.OperationReplayPanelAction.changeModeToSimu()},_cancel:function(a){if(a.down){this.onCancel()}},onCancel:function(){if(this.state.configuring||!this.state.before){return}this.onChangeModeToSimu()},_configure:function(a){if(a.down){this.setState({configuring:true})}},onConfigure:function(){if(this.state.configuring){return}this.setState({configuring:true})},onConfigChange:function(){this.setState({configuring:false,keyConfig:C.ConfigStore.keyConfig(C.Constants.Mode.Replay)})},onConfigCancel:function(){this.setState({configuring:false})},render:function(){var a="";if(!!this.state.urlParameters){a=location.href.split("?")[0]+"?"+this.state.urlParameters}return React.createElement("div",{className:"operation-panel"},React.createElement("h1",null,"OPERATION"),React.createElement("div",{className:"operation-mode-panel"},React.createElement("div",{className:"operation-replay-panel"},React.createElement("a",{className:"operation-btn",href:"javascript:void(0)",onClick:this.onBack},"<"),React.createElement("a",{className:"operation-btn",href:"javascript:void(0)",onClick:this.onForward},">"),React.createElement("a",{className:"operation-btn",href:"javascript:void(0)",onClick:this.onBackToHead},"□"),React.createElement("div",{className:"operation-sub-title"},"MODE"),React.createElement("a",{className:"operation-btn",href:"javascript:void(0)",onClick:this.onChangeModeToSimu},(!!this.state.before)?"戻る":"Simu"),React.createElement("div",{className:"operation-sub-title"},"TOOL"),React.createElement("a",{className:"operation-btn",href:"javascript:void(0)",onClick:this.onCreateUrlParameters},"URL出力"),React.createElement("a",{className:"operation-btn",href:"javascript:void(0)",onClick:this.onConfigure},"設定"),React.createElement("textarea",{id:"url-output",className:"url",readOnly:"true",value:a})),this.state.configuring?React.createElement(ConfigPanel,null):false))}});var OperationSimuPanel=React.createClass({displayName:"OperationSimuPanel",getInitialState:function(){return{before:C.SimuStore.context().before,configuring:false,keyConfig:C.ConfigStore.keyConfig(C.Constants.Mode.Simu),seed:C.SimuStore.seed(),urlParameters:C.SimuStore.urlParameters()}},componentDidMount:function(){C.ControllerStore.addKeyListener(this.onKey);C.SimuStore.addChangeListener(this.onChange);C.SimuStore.addSetUrlListener(this.onSetUrl);C.ConfigStore.addChangeListener(this.onConfigChange);C.ConfigStore.addCancelListener(this.onConfigCancel)},componentWillUnmount:function(){C.ControllerStore.removeKeyListener(this.onKey);C.SimuStore.removeChangeListener(this.onChange);C.SimuStore.removeSetUrlListener(this.onSetUrl);C.ConfigStore.removeChangeListener(this.onConfigChange);C.ConfigStore.removeCancelListener(this.onConfigCancel)},onKey:function(b){if(this.state.configuring){return}var a=this.state.keyConfig[b.keyName];if(a==null){return}this["_"+a](b)},_hardDrop:function(a){if(a.down){this.onHardDrop()}},onHardDrop:function(){if(this.state.configuring){return}C.OperationSimuPanelAction.hardDrop()},_softDrop:function(a){if(a.intervalDown){this.onSoftDrop()}},onSoftDrop:function(){if(this.state.configuring){return}C.OperationSimuPanelAction.softDrop()},_leftMove:function(a){if(a.intervalDown){this.onLeftMove()}},onLeftMove:function(){if(this.state.configuring){return}C.OperationSimuPanelAction.leftMove()},_rightMove:function(a){if(a.intervalDown){this.onRightMove()}},onRightMove:function(){if(this.state.configuring){return}C.OperationSimuPanelAction.rightMove()},_turnLeft:function(a){if(a.down){this.onTurnLeft()}},onTurnLeft:function(){if(this.state.configuring){return}C.OperationSimuPanelAction.turnLeft()},_turnRight:function(a){if(a.down){this.onTurnRight()}},onTurnRight:function(){if(this.state.configuring){return}C.OperationSimuPanelAction.turnRight()},_hold:function(a){if(a.down){this.onHold()}},onHold:function(){if(this.state.configuring){return}C.OperationSimuPanelAction.hold()},_retry:function(a){if(a.intervalDown){this.onRetry()}},onRetry:function(){if(this.state.configuring){return}C.OperationSimuPanelAction.retry(false)},_superRetry:function(a){if(a.intervalDown){this.onSuperRetry()}},onSuperRetry:function(){if(this.state.configuring){return}C.OperationSimuPanelAction.retry(true)},_clear:function(a){if(a.down){this.onClear()}},onClear:function(){if(this.state.configuring){return}C.OperationSimuPanelAction.clear()},_back:function(a){if(a.intervalDown){this.onBack()}},onBack:function(){if(this.state.configuring){return}C.OperationSimuPanelAction.back()},_forward:function(a){if(a.intervalDown){this.onForward()}},onForward:function(){if(this.state.configuring){return}C.OperationSimuPanelAction.forward()},_configure:function(a){if(a.down){this.setState({configuring:true})}},_createUrlParameters:function(a){if(a.down){this.onCreateUrlParameters()}},onCreateUrlParameters:function(){if(this.state.configuring){return}C.OperationSimuPanelAction.createUrlParameters()},onConfigure:function(){if(this.state.configuring){return}this.setState({configuring:true})},onChange:function(){this.setState({seed:C.SimuStore.seed()})},onSetUrl:function(){this.setState({urlParameters:C.SimuStore.urlParameters()});setTimeout(function(){$("#url-output").select()},0)},_changeModeToEdit:function(a){if(a.down){this.onChangeModeToEdit()}},onChangeModeToEdit:function(){if(this.state.configuring){return}C.OperationSimuPanelAction.changeModeToEdit()},_changeModeToReplay:function(a){if(a.down){this.onChangeModeToReplay()}},onChangeModeToReplay:function(){if(this.state.configuring){return}C.OperationSimuPanelAction.changeModeToReplay()},_backToEditMode:function(a){if(a.down){this.onBackToEditMode()}},onBackToEditMode:function(){if(this.state.configuring||!this.state.before){return}C.OperationSimuPanelAction.backToEditMode()},onConfigChange:function(){this.setState({configuring:false,keyConfig:C.ConfigStore.keyConfig(C.Constants.Mode.Simu)})},onConfigCancel:function(){this.setState({configuring:false})},render:function(){var a="";if(!!this.state.urlParameters){a=location.href.split("?")[0]+"?"+this.state.urlParameters}return React.createElement("div",{className:"operation-panel"},React.createElement("h1",null,"OPERATION"),React.createElement("div",{className:"operation-mode-panel"},React.createElement("div",{className:"operation-simu-panel"},React.createElement("a",{className:"operation-btn",href:"javascript:void(0)",onClick:this.onBack},"<"),React.createElement("a",{className:"operation-btn",href:"javascript:void(0)",onClick:this.onForward},">"),React.createElement("a",{className:"operation-btn",href:"javascript:void(0)",onClick:this.onRetry},"リトライ"),React.createElement("a",{className:"operation-btn",href:"javascript:void(0)",onClick:this.onSuperRetry},"スーパーリトライ"),React.createElement("a",{className:"operation-btn",href:"javascript:void(0)",onClick:this.onClear},"クリア"),React.createElement("div",{className:"operation-sub-title"},"MODE"),React.createElement("a",{className:"operation-btn",href:"javascript:void(0)",onClick:this.onChangeModeToReplay},"Replay"),React.createElement("a",{className:"operation-btn",href:"javascript:void(0)",onClick:this.onChangeModeToEdit},"Edit"),(!!this.state.before)?React.createElement("a",{className:"operation-btn",href:"javascript:void(0)",onClick:this.onBackToEditMode},"戻る"):"",React.createElement("div",{className:"operation-sub-title"},"TOOL"),React.createElement("a",{className:"operation-btn",href:"javascript:void(0)",onClick:this.onCreateUrlParameters},"URL出力"),React.createElement("a",{className:"operation-btn",href:"javascript:void(0)",onClick:this.onConfigure},"設定"),React.createElement("textarea",{id:"url-output",className:"url",readOnly:"true",value:a}),React.createElement("div",{className:"bottom"},React.createElement("span",{className:"seed"},"seed: ",("000000"+this.state.seed).slice(-6)))),this.state.configuring?React.createElement(ConfigPanel,null):false))}});var ReplayPanel=React.createClass({displayName:"ReplayPanel",componentWillMount:function(){C.ReplayPanelAction.initialize(this.props.context)},render:function(){return React.createElement("div",{className:"main-panel"},React.createElement(LeftReplayPanel,null),React.createElement(FieldReplayPanel,null),React.createElement(NextReplayPanel,null),React.createElement(OperationReplayPanel,{context:this.props.context}),React.createElement("div",{className:"status"},React.createElement("div",{className:"mode"},"Replay"),React.createElement("div",{className:"version"},"Ver. ",C.Constants.Version)))}});var SimuPanel=React.createClass({displayName:"SimuPanel",componentWillMount:function(){C.SimuPanelAction.initialize(this.props.context)},componentWillReceiveProps:function(a){C.SimuPanelAction.initialize(a.context)},render:function(){return React.createElement("div",{className:"main-panel"},React.createElement(LeftSimuPanel,null),React.createElement(FieldSimuPanel,null),React.createElement(NextSimuPanel,null),React.createElement(OperationSimuPanel,{context:this.props.context}),React.createElement("div",{className:"status"},React.createElement("div",{className:"mode"},"Simu"),React.createElement("div",{className:"version"},"Ver. ",C.Constants.Version)))}});